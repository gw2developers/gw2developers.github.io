{"title":"WebSocket location server/client map thing","pubDate":"2013-06-29T08:54:46.000Z","guid":"http://forum-en.guildwars2.com/forum/community/api/WebSocket-location-server-client-map-thing","comments":[{"pubDate":"2013-07-05T16:57:24.000Z","guid":"http://forum-en.guildwars2.com/forum/community/api/WebSocket-location-server-client-map-thing/2354825","author":"Edgar Doiron.2804","body":"\n<p>Thanks<br>\nI hosted it on my website last night, works flawlessly</p>","arenanet":false},{"pubDate":"2013-07-04T00:46:34.000Z","guid":"http://forum-en.guildwars2.com/forum/community/api/WebSocket-location-server-client-map-thing/2345034","author":"DarkSpirit.7046","body":"\n<p>Thanks zeeZ!</p>\n<p>And I presume your server is listening at local.ctrl-alt-chainsaw.net:8888.</p>","arenanet":false},{"pubDate":"2013-07-02T20:44:36.000Z","guid":"http://forum-en.guildwars2.com/forum/community/api/WebSocket-location-server-client-map-thing/2335996","author":"zeeZ.5713","body":"\n<p>As of right now, what’s being sent is basically this:</p>\n<p><strong>Client output:</strong></p>\n<p>{<br>\n“map”: <em>int map_id</em>,<br>\n“continent”: <em>int continent_id</em>,<br>\n“name”: <em>string character name</em>,<br>\n“face”: <em>float face direction in degrees</em>,<br>\n“elevation”: <em>float adjusted elevation</em>,<br>\n“position”: [<em>float adjusted x</em>, <em>float adjusted y</em>]<br>\n}<br>\nencoded in Base64.</p>\n<p><em>map_id</em> is bytes 27 and 28 from <strong>context</strong> as uint32 (counting from 0), I believe<br>\n<em>continent_id</em> is from <a href=\"https://api.guildwars2.com/v1/maps.json?map_id\">https://api.guildwars2.com/v1/maps.json?map_id</a>=… (cache that thing on every map change)<br>\n<em>name</em> is <strong>identity</strong><br>\n<em>face</em> is -(atan2(<strong>fAvatarFront[ 2 ], fAvatarFront[ 0 ]</strong>)*180/pi)%360<br>\n<em>elevation</em> is <strong>fAvatarPosition[ 1 ]</strong>*39.3701<br>\n<em>position</em> is <strong>fAvatarPosition[ 0 , 2 ]</strong>*39.3701, then <a href=\"https://forum-en.guildwars2.com/forum/community/api/Event-Details-API-location-coordinates/first#post2318071\">transformed from map coordinates to continent coordinates</a></p>\n<p></p>\n<p><strong>Server output:</strong></p>\n<p>[{<em>client 1</em>}, {<em>client 2</em>}, …]<br>\nunencoded…</p>\n<p>Client connets to: ws://<strong>host</strong>/publish/<strong>key</strong><br>\nMap connects to: ws://<strong>host</strong>/players.json/<strong>key</strong></p>\n<p>There is no other fancy stuff being done on connect other than what simple <a href=\"http://en.wikipedia.org/wiki/WebSocket\">WebSockets</a> do.</p>\n<p>The server will accept more data than the above minimum, but will simply discard it.</p>","arenanet":false},{"pubDate":"2013-07-02T17:28:30.000Z","guid":"http://forum-en.guildwars2.com/forum/community/api/WebSocket-location-server-client-map-thing/2334784","author":"DarkSpirit.7046","body":"\n<p>It can be useful if you provide short documentations on how we can communicate with your server if we decide to write our own client.</p>","arenanet":false},{"pubDate":"2013-07-02T07:24:21.000Z","guid":"http://forum-en.guildwars2.com/forum/community/api/WebSocket-location-server-client-map-thing/2332017","author":"zeeZ.5713","body":"\n<blockquote><div class=\"citey\"><cite title=\"Posted on July 02 2013 05:38AM\"><a href=\"/forum/community/api/WebSocket-location-server-client-map-thing/2331649\">vanzan.1250:</a></cite></div><div class=\"quotey\"><p>Do I run location distributor on my server forward the ports add a key to it and then host the webpage with the distributor address and key for it to work like this?</p></div></blockquote>\n<p>The distributor doesn’t care about the keys really, all you set it up with is a port and update frequency (no binding to a specific interface yet, sorry).</p>\n<p>You’d set it and a map modified for your needs up somewhere, give your people the sender and point them to it.</p>\n<p>Ideally you’d have a prompt for the key on both sender and map, so if a third party knew where your map was they’d not get your locations.</p>\n<p>For ease of use give them the sender as an exe and a preconfigured bat along with it to run that thing, like:</p>\n<pre><code>\n@echo off\nset /P key=\"Enter key: \" %=%\nlocation_sender.exe local.ctrl-alt-chainsaw.net -l info -p 8888 -f 0.5 -k %key%\npause</code></pre>\n<p>They’d enter it as they run the bat and open the map, and off they go. Or you hard code it on the map and/or client and hope nobody from the other side figures out where your map is<img src=\"/include/images/smilies/wink.png\"></p>\n<p>As for the icon, line 144 sets the icon style for a new player, which is defined in 105-110.<br>\nYou could define a new icon, like “leaderIcon” along with a list of your leaders, like “var leaders = [‘Gir Doomsong’,‘Inventor Zim’];” somewhere, and modify line 144 to read something like “icon: leaders.indexOf(player.name)&gt;=0? leaderIcon : posIcon,” or something :P</p>\n<p>I should definitely update the map a little if I get around to….</p>","arenanet":false},{"pubDate":"2013-07-02T05:38:41.000Z","guid":"http://forum-en.guildwars2.com/forum/community/api/WebSocket-location-server-client-map-thing/2331649","author":"vanzan.1250","body":"\n<blockquote><div class=\"citey\"><cite title=\"Posted on June 29 2013 08:54AM\"><a href=\"/forum/community/api/WebSocket-location-server-client-map-thing/2314520\">zeeZ.5713:</a></cite></div><div class=\"quotey\"><p>Code: <a href=\"https://github.com/zeeZ/gw2-location\">https://github.com/zeeZ/gw2-location</a><br>\nMap: <a href=\"http://dl.dropboxusercontent.com/u/6664141/gw2/map.html\">http://dl.dropboxusercontent.com/u/6664141/gw2/map.html</a><br>\n“Binaries”: <a href=\"https://dl.dropboxusercontent.com/u/6664141/gw2/location_dist.zip\">https://dl.dropboxusercontent.com/u/6664141/gw2/location_dist.zip</a></p>\n<p>Right now it’s a very basic implementation and due to lack of free time won’t move at much speed, but I welcome any pull requests.</p>\n<p>It consists of three things:<br>\n<strong>location_sender</strong> uses <a href=\"https://forum-en.guildwars2.com/forum/community/api/Map-API-Mumble-Mashup/first#post2256444\">the MumbleLink data GW2 provides</a> and based on an API call translates your map coordinates to world coordinates, then opens a WebSocket to location_distributor and continually sends it your position</p>\n<p><strong>location_distributor</strong> takes that data, does a minimal amount of sanity checking, puts it into a big list and provides a second WebSocket which the map can connect to, to perpetually receive a list of players and their location</p>\n<p><strong>map</strong>… well, is a basic map to show that data. Right now it doesn’t allow to change address and key on the fly, so you’d have to download and change it if you want to mess with different servers and keys.</p>\n<p>Both <strong>location_sender</strong> and <strong>map</strong> provide a key on connect to allow for grouping. The map will only receive location data for players that have provided the same key.</p>\n<p>You can sort of demo it by running <em>location_sender.{exe/py} local.ctrl-alt-chainsaw.net</em><br>\nWith both sender and map not providing a key I sort of consider that a public group :P</p></div></blockquote>\n<p>Looks great, I think from a WvW perspective being able to see our guild and what they are doing is invaluable.</p>\n<p>What would be great is if everyone could see green dots like those of your allies and a blue dot for the leader of your raid.</p>\n<p>Do I run location distributor on my server forward the ports add a key to it and then host the webpage with the distributor address and key for it to work like this?</p>","arenanet":false},{"pubDate":"2013-06-29T08:54:46.000Z","guid":"http://forum-en.guildwars2.com/forum/community/api/WebSocket-location-server-client-map-thing/2314520","author":"zeeZ.5713","body":"\n<p>Code: <a href=\"https://github.com/zeeZ/gw2-location\">https://github.com/zeeZ/gw2-location</a><br>\nMap: <a href=\"http://dl.dropboxusercontent.com/u/6664141/gw2/map.html\">http://dl.dropboxusercontent.com/u/6664141/gw2/map.html</a><br>\n“Binaries”: <a href=\"https://dl.dropboxusercontent.com/u/6664141/gw2/location_dist.zip\">https://dl.dropboxusercontent.com/u/6664141/gw2/location_dist.zip</a></p>\n<p>Right now it’s a very basic implementation and due to lack of free time won’t move at much speed, but I welcome any pull requests.</p>\n<p>It consists of three things:<br>\n<strong>location_sender</strong> uses <a href=\"https://forum-en.guildwars2.com/forum/community/api/Map-API-Mumble-Mashup/first#post2256444\">the MumbleLink data GW2 provides</a> and based on an API call translates your map coordinates to world coordinates, then opens a WebSocket to location_distributor and continually sends it your position</p>\n<p><strong>location_distributor</strong> takes that data, does a minimal amount of sanity checking, puts it into a big list and provides a second WebSocket which the map can connect to, to perpetually receive a list of players and their location</p>\n<p><strong>map</strong>… well, is a basic map to show that data. Right now it doesn’t allow to change address and key on the fly, so you’d have to download and change it if you want to mess with different servers and keys.</p>\n<p>Both <strong>location_sender</strong> and <strong>map</strong> provide a key on connect to allow for grouping. The map will only receive location data for players that have provided the same key.</p>\n<p>You can sort of demo it by running <em>location_sender.{exe/py} local.ctrl-alt-chainsaw.net</em><br>\nWith both sender and map not providing a key I sort of consider that a public group :P</p>","arenanet":false}]}