{"title":"Plotting events on a map","pubDate":"2013-09-26T03:32:14.000Z","guid":"http://forum-en.guildwars2.com/forum/community/api/Plotting-events-on-a-map","comments":[{"pubDate":"2013-09-26T16:38:11.000Z","guid":"http://forum-en.guildwars2.com/forum/community/api/Plotting-events-on-a-map/2918716","author":"datinc.7584","body":"\n<p>Thanks for the fast replies. It works perfectly now. Silly minus 1. I am not sure why they did that unless it is to cause developers sleepless nights.</p>","arenanet":false},{"pubDate":"2013-09-26T12:45:20.000Z","guid":"http://forum-en.guildwars2.com/forum/community/api/Plotting-events-on-a-map/2917590","author":"Dr Ishmael.9685","body":"\n<p>Specifically, see my second attachment in the thread that Smiley linked.  Y coordinates get inverted when translating between continent and map coordinates, I don’t know why, but that’s why you got a point near the south end of the map when it should be at the north end.</p>\n<p>In your fiddle, after the initial calculation of yMap, you need to do:</p>\n<p>yMap = 1 – yMap;</p>\n<p>before the yContinent calculation.</p>\n<p>[EDIT] Whoops, I just realized that there are parentheses missing in that image.  After the first set of parentheses in each equation, the (B2 – B1) terms should also be in parentheses, with the final + B1 outside of parentheses.  If I have time later I’ll try to remember to type that all up in LaTeX again.</p>","arenanet":false},{"pubDate":"2013-09-26T05:10:13.000Z","guid":"http://forum-en.guildwars2.com/forum/community/api/Plotting-events-on-a-map/2916120","author":"smiley.1438","body":"\n<p>For calculation of the map-coordinates -&gt; world-coordinates have a look at this thread:<br>\n<a href=\"https://forum-en.guildwars2.com/forum/community/api/Event-Details-API-location-coordinates/first#post2262330\">https://forum-en.guildwars2.com/forum/community/api/Event-Details-API-location-coordinates/first#post2262330</a></p>\n<p>tl;dr: use the following to recalculate your coords:</p>\n<pre><code>function recalc_coords(continent_rect, map_rect, coords){\n\treturn [\n\t\tMath.round(continent_rect[0][0]+(continent_rect[1][0]-continent_rect[0][0])*(coords[0]-map_rect[0][0])/(map_rect[1][0]-map_rect[0][0])),\n\t\tMath.round(continent_rect[0][1]+(continent_rect[1][1]-continent_rect[0][1])*(1-(coords[1]-map_rect[0][1])/(map_rect[1][1]-map_rect[0][1])))\n\t]\n}\n</code></pre>\n<p>live example (caution, overkill!) <a href=\"http://gw2.chillerlan.net/examples/gw2maps-jquery.html\">http://gw2.chillerlan.net/examples/gw2maps-jquery.html</a></p>\n<p>€: i checked your fiddle, the x coordinates were correct, buy y was far out, you should get [29753,12677]</p>","arenanet":false},{"pubDate":"2013-09-26T03:32:14.000Z","guid":"http://forum-en.guildwars2.com/forum/community/api/Plotting-events-on-a-map/2915846","author":"datinc.7584","body":"\n<p>I am trying to use the event_details to plot events on the world map. The issue the x,y,z returned in the event_details.json API is in map coordinates (I am guessing) and to plot them I need them in continent coordinates. To achieve this I get the details from maps.json which has map_rect and continent_rect. I am obviously doing something wrong because my events don’t plot correctly.</p>\n<p>Using the shatterer as an example:  <a href=\"https://api.guildwars2.com/v1/event_details.json?event_id=03BF176A-D59F-49CA-A311-39FC6F533F2F\">event_details.json</a> and <a href=\"https://api.guildwars2.com/v1/maps.json?map_id=20\">maps.json</a></p>\n<p>My math looks like:</p>\n<pre><code>\n\nmap_width = map_rect[1][0] - map_rect[0][0]; \nmap_height = map_rect[1][1] - map_rect[0][1];\n\ncontinent_width = continent_rect[1][0] - continent_rect[0][0]; \ncontinent_height = continent_rect[1][1] - continent_rect[0][1];\n\nxMap = (event_location[\"center\"][0] - map_rect[0][0])/map_width;\nyMap = (event_location[\"center\"][1] - map_rect[0][1] )/map_height;\n\nxContinent = continent_rect[0][0] + xMap * continent_width;\nyContinent = continent_rect[0][1] + yMap * continent_height;\n\n: xContinent = 29753.250000\n: yContinent = 15739.083008\n</code></pre>\n<p>This gets me near the bottom of the map! Am I doing it wrong or is there a better way to get the continent coordinate for an event?</p>\n<p>Here is a <a href=\"http://jsfiddle.net/datinc/WWyaZ/\">fiddle</a> so you can see the math in action</p>\n<p>THE FIX:<br>\nyMap = 1 – yMap;</p>","arenanet":false}]}