{"title":"Map tiles service intermittently cutting out","pubDate":"2013-06-27T11:07:31.000Z","guid":"http://forum-en.guildwars2.com/forum/community/api/Map-tiles-service-intermittently-cutting-out","comments":[{"pubDate":"2013-07-12T11:24:25.000Z","guid":"http://forum-en.guildwars2.com/forum/community/api/Map-tiles-service-intermittently-cutting-out/2398997","author":"smiley.1438","body":"\n<p>Only files within the clamped_view are available for download as Cliff mentioned above. <br>\nNow look at this line:</p>\n<pre><code>//bounds = new L.LatLngBounds(p2ll([0, (1 &lt;&lt; options.max_zoom)*256]), p2ll([(1 &lt;&lt; options.max_zoom)*256, 0]));\n\n</code></pre>\n<p><a href=\"https://github.com/codemasher/gw2api-tools/blob/3158b35a8ab5ba1b366865f8024131c6bbe0577c/js/gw2maps-gmaps.js#L152\">p2ll()</a> recalculates from pixels to lat/lng where the parameters are the NE and SW corners of the map – starting at 0 in this case. You can calculate like this:</p>\n<pre><code>2 ^ zoom = 1 &lt;&lt; zoom (bit shift) = tile_range (assuming all tiles are available)\n\nso:\n\n2 ^ max_zoom * tile_size = (1 &lt;&lt; max_zoom) * tile_size = texture_dims (where tile_size is 256)\n\n</code></pre>\n<p>With this knowledge you can check if a tile is in range by comparing to the clamped_view data. Google Maps for example uses a function as tile getter where you’re able to verify if a tile is in range:</p>\n<pre><code>function get_tile(coords,zoom){ // coords are the calculated tile coordinates which the app tries to download\n\tif(coords.y &lt; 0 || coords.x &lt; 0 || coords.y &gt;= (1 &lt;&lt; zoom) || coords.x &gt;= (1 &lt;&lt; zoom)){\n\t\treturn \"/path/to/errortile.jpg\";\n\t}\n\treturn \"https://tiles.guildwars2.com/\"+continent_id+\"/\"+floor_id+\"/\"+zoom+\"/\"+coords.x+\"/\"+coords.y+\".jpg\";\n}\n\n</code></pre>\n<p>You can replace the min and max values with the values of the clamped_view then (if available).</p>","arenanet":false},{"pubDate":"2013-07-12T11:19:41.000Z","guid":"http://forum-en.guildwars2.com/forum/community/api/Map-tiles-service-intermittently-cutting-out/2398984","author":"multivira.7925","body":"\n<blockquote><div class=\"citey\"><cite title=\"Posted on July 12 2013 10:57AM\"><a href=\"/forum/community/api/Map-tiles-service-intermittently-cutting-out/2398893\">Firilion.3867:</a></cite></div><div class=\"quotey\"><blockquote><div class=\"citey\"><cite title=\"Posted on July 11 2013 09:13PM\"><a href=\"/forum/community/api/Map-tiles-service-intermittently-cutting-out/2395454\">smiley.1438:</a></cite></div><div class=\"quotey\"><blockquote><div class=\"citey\"><cite title=\"Posted on July 11 2013 08:51PM\"><a href=\"/forum/community/api/Map-tiles-service-intermittently-cutting-out/2395314\">Firilion.3867:</a></cite></div><div class=\"quotey\"><p>Could you please help me a bit into the right direction to get Maps working?</p></div></blockquote>\n<p>This part of my code may give you an idea:</p>\n<p><a href=\"https://github.com/codemasher/gw2api-tools/blob/master/js/gw2maps-jquery.js#L153\">https://github.com/codemasher/gw2api-tools/blob/master/js/gw2maps-jquery.js#L153</a></p>\n<pre><code>\t\t// the map has a clamped view? ok, we use this as bound\n\t\tif(floordata.clamped_view){\n\t\t\tclamp = floordata.clamped_view;\n\t\t\tbounds = new L.LatLngBounds(p2ll([clamp[0][0], clamp[1][1]]), p2ll([clamp[1][0], clamp[0][1]])).pad(0.2);\n\t\t}\n\t\t// we display a specific map? so lets use the maps bounds\n\t\telse if(options.region_id &amp;&amp; options.map_id){\n\t\t\tclamp = floordata.regions[options.region_id].maps[options.map_id].continent_rect;\n\t\t\tbounds = new L.LatLngBounds(p2ll([clamp[0][0], clamp[1][1]]), p2ll([clamp[1][0], clamp[0][1]])).pad(0.4);\n\t\t}\n\t\t// else use the texture_dims as bounds\n\t\telse{\n\t\t\t//bounds = new L.LatLngBounds(p2ll([0, (1 &amp;lt;&amp;lt; options.max_zoom)*256]), p2ll([(1 &amp;lt;&amp;lt; options.max_zoom)*256, 0]));\n\t\t\tbounds = new L.LatLngBounds(p2ll([0, floordata.texture_dims[1]]), p2ll([floordata.texture_dims[0], 0])).pad(0.1);\n\t\t}\n\t\tmapobject.map.setMaxBounds(bounds).fitBounds(bounds);\n</code></pre></div></blockquote>\n<p>Thanks for your answer but i don’t get how this effects the tiles i have to download from tiles.guildwars2.com/cID/fID/zLevel/x/y.jpg<br>\nHow do i matchmake this with the clamped_view?<br>\nSince i can’t use leaflet I do not have those options you are using.</p>\n<p>Example: The Mists – Map<br>\ntiles.guildwars2.com/2/1/2/0/0.jpg does exist<br>\ntiles.guildwars2.com/2/1/3/0/0.jpg does not exist or is not available for dl</p>\n<p>How can i calculate which map-tiles are available at a specific zoom level?</p>\n<p>Thank for your help!</p></div></blockquote>\n<p>Just try and download them. If you get an error, just don’t display anything there. It will be very unlikely that people will want to view those areas anyway as they’re all white as far as I can tell.</p>","arenanet":false},{"pubDate":"2013-07-12T10:57:07.000Z","guid":"http://forum-en.guildwars2.com/forum/community/api/Map-tiles-service-intermittently-cutting-out/2398893","author":"Firilion.3867","body":"\n<blockquote><div class=\"citey\"><cite title=\"Posted on July 11 2013 09:13PM\"><a href=\"/forum/community/api/Map-tiles-service-intermittently-cutting-out/2395454\">smiley.1438:</a></cite></div><div class=\"quotey\"><blockquote><div class=\"citey\"><cite title=\"Posted on July 11 2013 08:51PM\"><a href=\"/forum/community/api/Map-tiles-service-intermittently-cutting-out/2395314\">Firilion.3867:</a></cite></div><div class=\"quotey\"><p>Could you please help me a bit into the right direction to get Maps working?</p></div></blockquote>\n<p>This part of my code may give you an idea:</p>\n<p><a href=\"https://github.com/codemasher/gw2api-tools/blob/master/js/gw2maps-jquery.js#L153\">https://github.com/codemasher/gw2api-tools/blob/master/js/gw2maps-jquery.js#L153</a></p>\n<pre><code>\t\t// the map has a clamped view? ok, we use this as bound\n\t\tif(floordata.clamped_view){\n\t\t\tclamp = floordata.clamped_view;\n\t\t\tbounds = new L.LatLngBounds(p2ll([clamp[0][0], clamp[1][1]]), p2ll([clamp[1][0], clamp[0][1]])).pad(0.2);\n\t\t}\n\t\t// we display a specific map? so lets use the maps bounds\n\t\telse if(options.region_id &amp;&amp; options.map_id){\n\t\t\tclamp = floordata.regions[options.region_id].maps[options.map_id].continent_rect;\n\t\t\tbounds = new L.LatLngBounds(p2ll([clamp[0][0], clamp[1][1]]), p2ll([clamp[1][0], clamp[0][1]])).pad(0.4);\n\t\t}\n\t\t// else use the texture_dims as bounds\n\t\telse{\n\t\t\t//bounds = new L.LatLngBounds(p2ll([0, (1 &amp;lt;&amp;lt; options.max_zoom)*256]), p2ll([(1 &amp;lt;&amp;lt; options.max_zoom)*256, 0]));\n\t\t\tbounds = new L.LatLngBounds(p2ll([0, floordata.texture_dims[1]]), p2ll([floordata.texture_dims[0], 0])).pad(0.1);\n\t\t}\n\t\tmapobject.map.setMaxBounds(bounds).fitBounds(bounds);\n</code></pre></div></blockquote>\n<p>Thanks for your answer but i don’t get how this effects the tiles i have to download from tiles.guildwars2.com/cID/fID/zLevel/x/y.jpg<br>\nHow do i matchmake this with the clamped_view?<br>\nSince i can’t use leaflet I do not have those options you are using.</p>\n<p>Example: The Mists – Map<br>\ntiles.guildwars2.com/2/1/2/0/0.jpg does exist<br>\ntiles.guildwars2.com/2/1/3/0/0.jpg does not exist or is not available for dl</p>\n<p>How can i calculate which map-tiles are available at a specific zoom level?</p>\n<p>Thank for your help!</p>","arenanet":false},{"pubDate":"2013-07-11T21:13:44.000Z","guid":"http://forum-en.guildwars2.com/forum/community/api/Map-tiles-service-intermittently-cutting-out/2395454","author":"smiley.1438","body":"\n<blockquote><div class=\"citey\"><cite title=\"Posted on July 11 2013 08:51PM\"><a href=\"/forum/community/api/Map-tiles-service-intermittently-cutting-out/2395314\">Firilion.3867:</a></cite></div><div class=\"quotey\"><p>Could you please help me a bit into the right direction to get Maps working?</p></div></blockquote>\n<p>This part of my code may give you an idea:</p>\n<p><a href=\"https://github.com/codemasher/gw2api-tools/blob/master/js/gw2maps-jquery.js#L153\">https://github.com/codemasher/gw2api-tools/blob/master/js/gw2maps-jquery.js#L153</a></p>\n<pre><code>\t\t// the map has a clamped view? ok, we use this as bound\n\t\tif(floordata.clamped_view){\n\t\t\tclamp = floordata.clamped_view;\n\t\t\tbounds = new L.LatLngBounds(p2ll([clamp[0][0], clamp[1][1]]), p2ll([clamp[1][0], clamp[0][1]])).pad(0.2);\n\t\t}\n\t\t// we display a specific map? so lets use the maps bounds\n\t\telse if(options.region_id &amp;&amp; options.map_id){\n\t\t\tclamp = floordata.regions[options.region_id].maps[options.map_id].continent_rect;\n\t\t\tbounds = new L.LatLngBounds(p2ll([clamp[0][0], clamp[1][1]]), p2ll([clamp[1][0], clamp[0][1]])).pad(0.4);\n\t\t}\n\t\t// else use the texture_dims as bounds\n\t\telse{\n\t\t\t//bounds = new L.LatLngBounds(p2ll([0, (1 &lt;&lt; options.max_zoom)*256]), p2ll([(1 &lt;&lt; options.max_zoom)*256, 0]));\n\t\t\tbounds = new L.LatLngBounds(p2ll([0, floordata.texture_dims[1]]), p2ll([floordata.texture_dims[0], 0])).pad(0.1);\n\t\t}\n\t\tmapobject.map.setMaxBounds(bounds).fitBounds(bounds);\n</code></pre>","arenanet":false},{"pubDate":"2013-07-11T20:51:24.000Z","guid":"http://forum-en.guildwars2.com/forum/community/api/Map-tiles-service-intermittently-cutting-out/2395314","author":"Firilion.3867","body":"\n<blockquote><div class=\"citey\"><cite title=\"Posted on July 10 2013 11:59PM\"><a href=\"/forum/community/api/Map-tiles-service-intermittently-cutting-out/2388521\">Cliff Spradlin.3512:</a></cite></div><div class=\"quotey\"><blockquote><div class=\"citey\"><cite title=\"Posted on July 09 2013 09:09PM\"><a href=\"/forum/community/api/Map-tiles-service-intermittently-cutting-out/2379225\">smiley.1438:</a></cite></div><div class=\"quotey\"><p>Well, not really an outage, but is it just me or aren’t the tiles updated with the new map yet?</p>\n<p>Oh and while i’m at it:</p>\n<p>According to texture_dims, these tiles should exist, right? (They actually do exist, but only for zoom level 1 and 2)<br>\n</p><pre><code>\nGET https://tiles.guildwars2.com/2/1/3/0/0.jpg 403 (Forbidden) tiles.guildwars2.com/2/1/3/0/0.jpg:1\nGET https://tiles.guildwars2.com/2/1/3/1/0.jpg 403 (Forbidden) tiles.guildwars2.com/2/1/3/1/0.jpg:1\nGET https://tiles.guildwars2.com/2/1/3/2/0.jpg 403 (Forbidden) tiles.guildwars2.com/2/1/3/2/0.jpg:1\nGET https://tiles.guildwars2.com/2/1/3/3/0.jpg 403 (Forbidden) tiles.guildwars2.com/2/1/3/3/0.jpg:1\nGET https://tiles.guildwars2.com/2/1/3/4/0.jpg 403 (Forbidden) tiles.guildwars2.com/2/1/3/4/0.jpg:1\n...</code></pre><p></p>\n<p><a href=\"http://gw2.chillerlan.net/examples/gw2maps-gmaps-simple.html\">http://gw2.chillerlan.net/examples/gw2maps-gmaps-simple.html</a> -&gt; switch to the mists and see</p></div></blockquote>\n<p>You need to respect the clamped_view from the map_floor api. From the docs: “The map_floor.json API contains useful information like the size of each floor, and bounding rects. The bounding rects define which tiles are available for download, as well as the area of the map that should presented to the user. Tiles outside of the bounding rect are not available for download.”</p>\n<p><a href=\"https://api.guildwars2.com/v1/map_floor.json?continent_id=2&floor=1\">https://api.guildwars2.com/v1/map_floor.json?continent_id=2&amp;floor=1</a></p>\n<p>“clamped_view”: [<br>\n[0,4094], [16382,16382]<br>\n]</p>\n<p>Sorry if it’s confusing – world maps are complicated.</p></div></blockquote>\n<p>It is a bit confusing to me how i have to use the clamped_view. I am trying to build a world map in c# (within a WPF Client) without using leaflet and co. and it is very hard to get it running.</p>\n<p>This will become part of a tool for my guild which is currently under development. It uses WCF Services hosted on an IIS, Data-Storage within a SQL Server and a WPF – Client for my fellow Guildies. It is currently Alpha status an we are testing a lot. <br>\nRight now we have a complete Calendar with Appointments, a Userlist with Auto-Invite, Boss-Timer, Live-WvW Maps  and a lot more but the biggest thing missing are integrated Maps.</p>\n<p>Could you please help me a bit into the right direction to get Maps working?<br>\nThanks a lot and please excuse my bad english</p>\n<p>Many Greetings<br>\nFirilion</p>\n<p>p.s.: Maybe i’ll post a youtube video of our tool later on (actually i only have some video footage in german language). When it is done, i will try to get it installable and so distributable to anyone who is interested.</p>","arenanet":false},{"pubDate":"2013-07-11T00:07:55.000Z","guid":"http://forum-en.guildwars2.com/forum/community/api/Map-tiles-service-intermittently-cutting-out/2388563","author":"smiley.1438","body":"\n<p>I’m aware of the clamped_view, i was just wondering because the tiles are available at zoom 1&amp;2<img src=\"/include/images/smilies/wink.png\"></p>","arenanet":false},{"pubDate":"2013-07-10T23:59:24.000Z","guid":"http://forum-en.guildwars2.com/forum/community/api/Map-tiles-service-intermittently-cutting-out/2388521","author":"Cliff Spradlin.3512","body":"\n<blockquote><div class=\"citey\"><cite title=\"Posted on July 09 2013 09:09PM\"><a href=\"/forum/community/api/Map-tiles-service-intermittently-cutting-out/2379225\">smiley.1438:</a></cite></div><div class=\"quotey\"><p>Well, not really an outage, but is it just me or aren’t the tiles updated with the new map yet?</p>\n<p>Oh and while i’m at it:</p>\n<p>According to texture_dims, these tiles should exist, right? (They actually do exist, but only for zoom level 1 and 2)<br>\n</p><pre><code>\nGET https://tiles.guildwars2.com/2/1/3/0/0.jpg 403 (Forbidden) tiles.guildwars2.com/2/1/3/0/0.jpg:1\nGET https://tiles.guildwars2.com/2/1/3/1/0.jpg 403 (Forbidden) tiles.guildwars2.com/2/1/3/1/0.jpg:1\nGET https://tiles.guildwars2.com/2/1/3/2/0.jpg 403 (Forbidden) tiles.guildwars2.com/2/1/3/2/0.jpg:1\nGET https://tiles.guildwars2.com/2/1/3/3/0.jpg 403 (Forbidden) tiles.guildwars2.com/2/1/3/3/0.jpg:1\nGET https://tiles.guildwars2.com/2/1/3/4/0.jpg 403 (Forbidden) tiles.guildwars2.com/2/1/3/4/0.jpg:1\n...</code></pre><p></p>\n<p><a href=\"http://gw2.chillerlan.net/examples/gw2maps-gmaps-simple.html\">http://gw2.chillerlan.net/examples/gw2maps-gmaps-simple.html</a> -&gt; switch to the mists and see</p></div></blockquote>\n<p>You need to respect the clamped_view from the map_floor api. From the docs: “The map_floor.json API contains useful information like the size of each floor, and bounding rects. The bounding rects define which tiles are available for download, as well as the area of the map that should presented to the user. Tiles outside of the bounding rect are not available for download.”</p>\n<p><a href=\"https://api.guildwars2.com/v1/map_floor.json?continent_id=2&floor=1\">https://api.guildwars2.com/v1/map_floor.json?continent_id=2&amp;floor=1</a></p>\n<p>“clamped_view”: [<br>\n[0,4094], [16382,16382]<br>\n]</p>\n<p>Sorry if it’s confusing – world maps are complicated.</p>","arenanet":true},{"pubDate":"2013-07-10T14:16:45.000Z","guid":"http://forum-en.guildwars2.com/forum/community/api/Map-tiles-service-intermittently-cutting-out/2384462","author":"multivira.7925","body":"\n<p>I’m guessing they can’t be bothered with purely white tiles</p>","arenanet":false},{"pubDate":"2013-07-09T21:09:57.000Z","guid":"http://forum-en.guildwars2.com/forum/community/api/Map-tiles-service-intermittently-cutting-out/2379225","author":"smiley.1438","body":"\n<p>Well, not really an outage, but is it just me or aren’t the tiles updated with the new map yet?</p>\n<p>Oh and while i’m at it:</p>\n<p>According to texture_dims, these tiles should exist, right? (They actually do exist, but only for zoom level 1 and 2)<br>\n</p><pre><code>\nGET https://tiles.guildwars2.com/2/1/3/0/0.jpg 403 (Forbidden) tiles.guildwars2.com/2/1/3/0/0.jpg:1\nGET https://tiles.guildwars2.com/2/1/3/1/0.jpg 403 (Forbidden) tiles.guildwars2.com/2/1/3/1/0.jpg:1\nGET https://tiles.guildwars2.com/2/1/3/2/0.jpg 403 (Forbidden) tiles.guildwars2.com/2/1/3/2/0.jpg:1\nGET https://tiles.guildwars2.com/2/1/3/3/0.jpg 403 (Forbidden) tiles.guildwars2.com/2/1/3/3/0.jpg:1\nGET https://tiles.guildwars2.com/2/1/3/4/0.jpg 403 (Forbidden) tiles.guildwars2.com/2/1/3/4/0.jpg:1\n...</code></pre><p></p>\n<p><a href=\"http://gw2.chillerlan.net/examples/gw2maps-gmaps-simple.html\">http://gw2.chillerlan.net/examples/gw2maps-gmaps-simple.html</a> -&gt; switch to the mists and see</p>","arenanet":false},{"pubDate":"2013-06-27T18:28:22.000Z","guid":"http://forum-en.guildwars2.com/forum/community/api/Map-tiles-service-intermittently-cutting-out/2302734","author":"Cliff Spradlin.3512","body":"\n<blockquote><div class=\"citey\"><cite title=\"Posted on June 27 2013 03:17PM\"><a href=\"/forum/community/api/Map-tiles-service-intermittently-cutting-out/2301300\">Drakma.1549:</a></cite></div><div class=\"quotey\"><p>This brings up a good point though. Cliff, how hard would it be to get an API status json that contained all if the API calls and their statuses?</p></div></blockquote>\n<p>It’s a good idea, but it’s not super easy, unfortunately. It would need to run on a server outside of our normal datacenters to be effective for external failures like DNS problems.</p>\n<p>We do have internal monitoring of our services of course, but errors reported by those systems don’t map directly to specific API failures. To do a really good job, we’d need to write services that top into our monitoring, and translate them to specific API failures.</p>\n<p>Long story short, if there’s enough interest, maybe one of you could write a status site<img src=\"/include/images/smilies/smile.png\">. It would probably work just as well as one we’d create, if not better.</p>","arenanet":true},{"pubDate":"2013-06-27T15:17:03.000Z","guid":"http://forum-en.guildwars2.com/forum/community/api/Map-tiles-service-intermittently-cutting-out/2301300","author":"Drakma.1549","body":"\n<p>This brings up a good point though. Cliff, how hard would it be to get an API status json that contained all if the API calls and their statuses?</p>","arenanet":false},{"pubDate":"2013-06-27T14:51:39.000Z","guid":"http://forum-en.guildwars2.com/forum/community/api/Map-tiles-service-intermittently-cutting-out/2301121","author":"ozma.3498","body":"\n<p>Thanks for the update Cliff!</p>","arenanet":false},{"pubDate":"2013-06-27T13:49:01.000Z","guid":"http://forum-en.guildwars2.com/forum/community/api/Map-tiles-service-intermittently-cutting-out/2300761","author":"smiley.1438","body":"\n<p>Ah, ok. Thanks for the info<img src=\"/include/images/smilies/smile.png\"></p>","arenanet":false},{"pubDate":"2013-06-27T13:44:24.000Z","guid":"http://forum-en.guildwars2.com/forum/community/api/Map-tiles-service-intermittently-cutting-out/2300725","author":"Cliff Spradlin.3512","body":"\n<p>Hi,</p>\n<p>We weren’t aware of the problem actually.</p>\n<p>Sorry about the outage — we changed our authoritative DNS servers this morning for guildwars2.com and it seems like tiles.guildwars2.com didn’t make it over to the new server.</p>\n<p>It should be fixed now, or within a few minutes depending on negative caching.</p>","arenanet":true},{"pubDate":"2013-06-27T13:41:45.000Z","guid":"http://forum-en.guildwars2.com/forum/community/api/Map-tiles-service-intermittently-cutting-out/2300708","author":"smiley.1438","body":"\n<p>Yup, map tile service seems to be completely down – i’m just getting th error tiles after a while.</p>\n<p><a href=\"http://wiki-de.guildwars2.com/wiki/Königintal/Interaktive_Karte\">http://wiki-de.guildwars2.com/wiki/Königintal/Interaktive_Karte</a></p>","arenanet":false},{"pubDate":"2013-06-27T11:26:05.000Z","guid":"http://forum-en.guildwars2.com/forum/community/api/Map-tiles-service-intermittently-cutting-out/2299978","author":"onekopaka.5803","body":"\n<p>I can’t even resolve tiles.guildwars2.com, both from Google Public DNS and my VPS provider’s DNS. OpenDNS seems to work fine though.</p>","arenanet":false},{"pubDate":"2013-06-27T11:07:31.000Z","guid":"http://forum-en.guildwars2.com/forum/community/api/Map-tiles-service-intermittently-cutting-out/2299896","author":"ozma.3498","body":"\n<p>I’m sure the devs are aware of it, but since it doesn’t look like anybody else has posted about it I thought I’d let you know that the map tile JPGs are intermittently not loading and have been this way for 8+ hours at the time of this post. It’s not just me – many others are having the same issue.</p>\n<p>For example:<br>\n<a href=\"https://tiles.guildwars2.com/1/1/7/62/66.jpg\">https://tiles.guildwars2.com/1/1/7/62/66.jpg</a></p>\n<p>This is just a randomly selected tile. At the time of this post, none of them will load.</p>","arenanet":false}]}