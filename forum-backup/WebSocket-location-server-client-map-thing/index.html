<!DOCTYPE html>
<html lang="en">

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>WebSocket location server/client map thing</title>
  <meta name="description" content="Learn how to use the GW2 API.">

  <link rel="stylesheet" href="/assets/main.css">
  <link rel="canonical" href="/forum-backup/WebSocket-location-server-client-map-thing/">
  <link rel="alternate" type="application/rss+xml" title="GW2 Developers" href="/feed.xml">
  
  
  <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-106748097-1', 'auto');
  ga('send', 'pageview');

</script>
  

  
</head>


  <body>

    <header class="site-header" role="banner">

  <div class="wrapper">
    
    
    <a class="site-title" href="/"><img src="/assets/images/logo.svg"></a>
  
    
      <nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
              <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
              <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger">
          
            
            
          
            
            
            <a class="page-link" href="/forum-backup/">Forum Backup</a>
            
          
            
            
            <a class="page-link" href="/guides/">Guides</a>
            
          
            
            
          
            
            
          
            
            
          
        </div>
      </nav>
    
  </div>
</header>

    <main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post">

  <header class="post-header">
    <h1 class="post-title">WebSocket location server/client map thing</h1>
  </header>

  <div class="post-content">
    


<p class="post-meta">
    Original Url: http://forum-en.guildwars2.com/forum/community/api/WebSocket-location-server-client-map-thing
</p>



<h2 id="">zeeZ.5713:</h2>
<p class="post-meta">
    <time datetime="2013-06-29T08:54:46+00:00">
        29 Jun 2013
    </time>
</p>
<p>
<p>Code: <a href="https://github.com/zeeZ/gw2-location">https://github.com/zeeZ/gw2-location</a><br>
Map: <a href="http://dl.dropboxusercontent.com/u/6664141/gw2/map.html">http://dl.dropboxusercontent.com/u/6664141/gw2/map.html</a><br>
“Binaries”: <a href="https://dl.dropboxusercontent.com/u/6664141/gw2/location_dist.zip">https://dl.dropboxusercontent.com/u/6664141/gw2/location_dist.zip</a></p>
<p>Right now it’s a very basic implementation and due to lack of free time won’t move at much speed, but I welcome any pull requests.</p>
<p>It consists of three things:<br>
<strong>location_sender</strong> uses <a href="/forum-backup/Map-API-Mumble-Mashup">the MumbleLink data GW2 provides</a> and based on an API call translates your map coordinates to world coordinates, then opens a WebSocket to location_distributor and continually sends it your position</p>
<p><strong>location_distributor</strong> takes that data, does a minimal amount of sanity checking, puts it into a big list and provides a second WebSocket which the map can connect to, to perpetually receive a list of players and their location</p>
<p><strong>map</strong>… well, is a basic map to show that data. Right now it doesn’t allow to change address and key on the fly, so you’d have to download and change it if you want to mess with different servers and keys.</p>
<p>Both <strong>location_sender</strong> and <strong>map</strong> provide a key on connect to allow for grouping. The map will only receive location data for players that have provided the same key.</p>
<p>You can sort of demo it by running <em>location_sender.{exe/py} local.ctrl-alt-chainsaw.net</em><br>
With both sender and map not providing a key I sort of consider that a public group :P</p></p>

<h2 id="">vanzan.1250:</h2>
<p class="post-meta">
    <time datetime="2013-07-02T05:38:41+00:00">
        02 Jul 2013
    </time>
</p>
<p>
<blockquote><div class="citey"><cite title="Posted on June 29 2013 08:54AM"><a href="/forum/community/api/WebSocket-location-server-client-map-thing/2314520">zeeZ.5713:</a></cite></div><div class="quotey"><p>Code: <a href="https://github.com/zeeZ/gw2-location">https://github.com/zeeZ/gw2-location</a><br>
Map: <a href="http://dl.dropboxusercontent.com/u/6664141/gw2/map.html">http://dl.dropboxusercontent.com/u/6664141/gw2/map.html</a><br>
“Binaries”: <a href="https://dl.dropboxusercontent.com/u/6664141/gw2/location_dist.zip">https://dl.dropboxusercontent.com/u/6664141/gw2/location_dist.zip</a></p>
<p>Right now it’s a very basic implementation and due to lack of free time won’t move at much speed, but I welcome any pull requests.</p>
<p>It consists of three things:<br>
<strong>location_sender</strong> uses <a href="/forum-backup/Map-API-Mumble-Mashup">the MumbleLink data GW2 provides</a> and based on an API call translates your map coordinates to world coordinates, then opens a WebSocket to location_distributor and continually sends it your position</p>
<p><strong>location_distributor</strong> takes that data, does a minimal amount of sanity checking, puts it into a big list and provides a second WebSocket which the map can connect to, to perpetually receive a list of players and their location</p>
<p><strong>map</strong>… well, is a basic map to show that data. Right now it doesn’t allow to change address and key on the fly, so you’d have to download and change it if you want to mess with different servers and keys.</p>
<p>Both <strong>location_sender</strong> and <strong>map</strong> provide a key on connect to allow for grouping. The map will only receive location data for players that have provided the same key.</p>
<p>You can sort of demo it by running <em>location_sender.{exe/py} local.ctrl-alt-chainsaw.net</em><br>
With both sender and map not providing a key I sort of consider that a public group :P</p></div></blockquote>
<p>Looks great, I think from a WvW perspective being able to see our guild and what they are doing is invaluable.</p>
<p>What would be great is if everyone could see green dots like those of your allies and a blue dot for the leader of your raid.</p>
<p>Do I run location distributor on my server forward the ports add a key to it and then host the webpage with the distributor address and key for it to work like this?</p></p>

<h2 id="">zeeZ.5713:</h2>
<p class="post-meta">
    <time datetime="2013-07-02T07:24:21+00:00">
        02 Jul 2013
    </time>
</p>
<p>
<blockquote><div class="citey"><cite title="Posted on July 02 2013 05:38AM"><a href="/forum/community/api/WebSocket-location-server-client-map-thing/2331649">vanzan.1250:</a></cite></div><div class="quotey"><p>Do I run location distributor on my server forward the ports add a key to it and then host the webpage with the distributor address and key for it to work like this?</p></div></blockquote>
<p>The distributor doesn’t care about the keys really, all you set it up with is a port and update frequency (no binding to a specific interface yet, sorry).</p>
<p>You’d set it and a map modified for your needs up somewhere, give your people the sender and point them to it.</p>
<p>Ideally you’d have a prompt for the key on both sender and map, so if a third party knew where your map was they’d not get your locations.</p>
<p>For ease of use give them the sender as an exe and a preconfigured bat along with it to run that thing, like:</p>
<pre><code>
@echo off
set /P key="Enter key: " %=%
location_sender.exe local.ctrl-alt-chainsaw.net -l info -p 8888 -f 0.5 -k %key%
pause</code></pre>
<p>They’d enter it as they run the bat and open the map, and off they go. Or you hard code it on the map and/or client and hope nobody from the other side figures out where your map is<img src="/include/images/smilies/wink.png"></p>
<p>As for the icon, line 144 sets the icon style for a new player, which is defined in 105-110.<br>
You could define a new icon, like “leaderIcon” along with a list of your leaders, like “var leaders = [‘Gir Doomsong’,‘Inventor Zim’];” somewhere, and modify line 144 to read something like “icon: leaders.indexOf(player.name)&gt;=0? leaderIcon : posIcon,” or something :P</p>
<p>I should definitely update the map a little if I get around to….</p></p>

<h2 id="">DarkSpirit.7046:</h2>
<p class="post-meta">
    <time datetime="2013-07-02T17:28:30+00:00">
        02 Jul 2013
    </time>
</p>
<p>
<p>It can be useful if you provide short documentations on how we can communicate with your server if we decide to write our own client.</p></p>

<h2 id="">zeeZ.5713:</h2>
<p class="post-meta">
    <time datetime="2013-07-02T20:44:36+00:00">
        02 Jul 2013
    </time>
</p>
<p>
<p>As of right now, what’s being sent is basically this:</p>
<p><strong>Client output:</strong></p>
<p>{<br>
“map”: <em>int map_id</em>,<br>
“continent”: <em>int continent_id</em>,<br>
“name”: <em>string character name</em>,<br>
“face”: <em>float face direction in degrees</em>,<br>
“elevation”: <em>float adjusted elevation</em>,<br>
“position”: [<em>float adjusted x</em>, <em>float adjusted y</em>]<br>
}<br>
encoded in Base64.</p>
<p><em>map_id</em> is bytes 27 and 28 from <strong>context</strong> as uint32 (counting from 0), I believe<br>
<em>continent_id</em> is from <a href="https://api.guildwars2.com/v1/maps.json?map_id">https://api.guildwars2.com/v1/maps.json?map_id</a>=… (cache that thing on every map change)<br>
<em>name</em> is <strong>identity</strong><br>
<em>face</em> is -(atan2(<strong>fAvatarFront[ 2 ], fAvatarFront[ 0 ]</strong>)*180/pi)%360<br>
<em>elevation</em> is <strong>fAvatarPosition[ 1 ]</strong>*39.3701<br>
<em>position</em> is <strong>fAvatarPosition[ 0 , 2 ]</strong>*39.3701, then <a href="/forum-backup/Event-Details-API-location-coordinates">transformed from map coordinates to continent coordinates</a></p>
<p></p>
<p><strong>Server output:</strong></p>
<p>[{<em>client 1</em>}, {<em>client 2</em>}, …]<br>
unencoded…</p>
<p>Client connets to: ws://<strong>host</strong>/publish/<strong>key</strong><br>
Map connects to: ws://<strong>host</strong>/players.json/<strong>key</strong></p>
<p>There is no other fancy stuff being done on connect other than what simple <a href="http://en.wikipedia.org/wiki/WebSocket">WebSockets</a> do.</p>
<p>The server will accept more data than the above minimum, but will simply discard it.</p></p>

<h2 id="">DarkSpirit.7046:</h2>
<p class="post-meta">
    <time datetime="2013-07-04T00:46:34+00:00">
        04 Jul 2013
    </time>
</p>
<p>
<p>Thanks zeeZ!</p>
<p>And I presume your server is listening at local.ctrl-alt-chainsaw.net:8888.</p></p>

<h2 id="">Edgar Doiron.2804:</h2>
<p class="post-meta">
    <time datetime="2013-07-05T16:57:24+00:00">
        05 Jul 2013
    </time>
</p>
<p>
<p>Thanks<br>
I hosted it on my website last night, works flawlessly</p></p>


  </div>

</article>

      </div>
    </main>

    <footer class="site-footer">

  <div class="wrapper">

    <h2 class="footer-heading">GW2 Developers</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li>
            
              GW2 Developers
            
            </li>
            
            <li><a href="mailto:gw2developers@darthmaim.de">gw2developers@darthmaim.de</a></li>
            
        </ul>
      </div>

      <div class="footer-col footer-col-2">
        <ul class="social-media-list">
          
          <li>
            <a href="https://github.com/gw2developers"><span class="icon icon--github"><svg viewBox="0 0 16 16" width="16px" height="16px"><path fill="#828282" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761 c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32 c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472 c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037 C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65 c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261 c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082 c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129 c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"/></svg>
</span><span class="username">gw2developers</span></a>

          </li>
          

          
          <li>
            <a href="https://twitter.com/gw2api"><span class="icon icon--twitter"><svg viewBox="0 0 16 16" width="16px" height="16px"><path fill="#828282" d="M15.969,3.058c-0.586,0.26-1.217,0.436-1.878,0.515c0.675-0.405,1.194-1.045,1.438-1.809c-0.632,0.375-1.332,0.647-2.076,0.793c-0.596-0.636-1.446-1.033-2.387-1.033c-1.806,0-3.27,1.464-3.27,3.27 c0,0.256,0.029,0.506,0.085,0.745C5.163,5.404,2.753,4.102,1.14,2.124C0.859,2.607,0.698,3.168,0.698,3.767 c0,1.134,0.577,2.135,1.455,2.722C1.616,6.472,1.112,6.325,0.671,6.08c0,0.014,0,0.027,0,0.041c0,1.584,1.127,2.906,2.623,3.206 C3.02,9.402,2.731,9.442,2.433,9.442c-0.211,0-0.416-0.021-0.615-0.059c0.416,1.299,1.624,2.245,3.055,2.271 c-1.119,0.877-2.529,1.4-4.061,1.4c-0.264,0-0.524-0.015-0.78-0.046c1.447,0.928,3.166,1.469,5.013,1.469 c6.015,0,9.304-4.983,9.304-9.304c0-0.142-0.003-0.283-0.009-0.423C14.976,4.29,15.531,3.714,15.969,3.058z"/></svg>
</span><span class="username">gw2api</span></a>

          </li>
          
        </ul>
      </div>

      <div class="footer-col footer-col-3">
        <p>Learn how to use the GW2 API.
</p>
      </div>
    </div>

  </div>

</footer>


  </body>

</html>
