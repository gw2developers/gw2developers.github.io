{"title":"WvW API and Website Question","pubDate":"2013-05-29T10:11:27.000Z","guid":"http://forum-en.guildwars2.com/forum/community/api/WvW-API-and-Website-Question","comments":[{"pubDate":"2013-05-30T08:48:05.000Z","guid":"http://forum-en.guildwars2.com/forum/community/api/WvW-API-and-Website-Question/2119721","author":"Foghladha.2506","body":"\n<p>Lastly you need to build the data to import into your table.</p>\n<blockquote><div class=\"quotey\"><p>$ch = curl_init();<br>\ncurl_setopt($ch, CURLOPT_URL, “<a href=\"https://api.guildwars2.com/v1/wvw/match_details.json?match_id\">https://api.guildwars2.com/v1/wvw/match_details.json?match_id</a>=”.$sormatch);<br>\ncurl_setopt($ch, CURLOPT_HEADER, 0);<br>\n$curlRes = curl_exec($ch);<br>\ncurl_close($ch);<br>\n$data = json_decode($curlRes, true);<br>\n$r[‘score’] = $data[‘scores’]<sup class=\"footnote\"><a href=\"#fn0\">0</a></sup>;<br>\n$r[‘name’]  = $world[$r[‘id’]];<br>\n$b[‘score’] = $data[‘scores’]<sup class=\"footnote\"><a href=\"#fn1\">1</a></sup>;<br>\n$b[‘name’]  = $world[$b[‘id’]];<br>\n$g[‘score’] = $data[‘scores’]<sup class=\"footnote\"><a href=\"#fn2\">2</a></sup>;<br>\n$g[‘name’]  = $world[$g[‘id’]];<br>\n$side[‘Red’] = $r[‘name’];<br>\n$side[‘Blue’] = $b[‘name’];<br>\n$side[‘Green’] = $g[‘name’];<br>\n$pts[‘Camp’]   = “5”;<br>\n$pts[‘Keep’]   = “25”;<br>\n$pts[‘Tower’]  = “10”;<br>\n$pts[‘Castle’] = “35”;<br>\n/*<br>\nCALCULATE POINT TOTALS<br>\n*/<br>\n$battle = $data[‘maps’];<br>\n$warzones[‘Center’]    = “Eternal Battleground”; $warzonescode[‘Center’]    = “eb”;<br>\n$warzones[‘BlueHome’]  = “Blue Borderlands”;     $warzonescode[‘BlueHome’]  = “bb”;<br>\n$warzones[‘RedHome’]   = “Red Borderlands”;      $warzonescode[‘RedHome’]   = “rb”;<br>\n$warzones[‘GreenHome’] = “Green Borderlands”;    $warzonescode[‘GreenHome’] = “gb”;<br>\n$r[‘tick’]      = 0;<br>\n$b[‘tick’]      = 0;<br>\n$g[‘tick’]      = 0;<br>\n// PRESET TOTALS<br>\n$totals[‘eb’][‘sc’]     = 0;<br>\n$totals[‘eb’][‘tower’]  = 0;<br>\n$totals[‘eb’][‘keep’]   = 0;<br>\n$totals[‘eb’][‘castle’] = 0;<br>\n$totals[‘bb’][‘sc’]     = 0;<br>\n$totals[‘bb’][‘tower’]  = 0;<br>\n$totals[‘bb’][‘keep’]   = 0;<br>\n$totals[‘bb’][‘castle’] = 0;<br>\n$totals[‘gb’][‘sc’]     = 0;<br>\n$totals[‘gb’][‘tower’]  = 0;<br>\n$totals[‘gb’][‘keep’]   = 0;<br>\n$totals[‘gb’][‘castle’] = 0;<br>\n$totals[‘rb’][‘sc’]     = 0;<br>\n$totals[‘rb’][‘tower’]  = 0;<br>\n$totals[‘rb’][‘keep’]   = 0;<br>\n$totals[‘rb’][‘castle’] = 0;</p>\n<p>foreach ($battle as &amp;$v) {<br>\n  $bg[‘name’] = $warzones[$v[‘type’]];<br>\n  $bg[‘code’] = $warzonescode[$v[‘type’]];<br>\n  foreach ($v[‘objectives’] as &amp;$o) {<br>\n    $id = $o[‘id’];<br>\n    $type = $objective[$id];<br>\n    $faction = $side[$o[‘owner’]];<br>\n    if(isset($o[‘owner_guild’])) {<br>\n      $claimed = 1;<br>\n      $text = \" and is claimed\";<br>\n      $guild = $o[‘owner_guild’];<br>\n    } else {<br>\n      $claimed = 0;<br>\n      $text = \"\";<br>\n    }<br>\n    if($type == “Keep”) { <br>\n      $ptsaward = 25;<br>\n      $objtype = “keep”;<br>\n    } elseif($type == “Tower”) {<br>\n      $ptsaward = 10;<br>\n      $objtype = “tower”;<br>\n      <br>\n    } elseif($type == “Castle”) {<br>\n      $ptsaward = 35;<br>\n      $objtype = “castle”;<br>\n    } else {<br>\n      $ptsaward = 5;<br>\n      $objtype = “sc”;<br>\n    }<br>\n    if($faction == “Sanctum of Rall”) {<br>\n      $totals[$bg[‘code’]][$objtype] = $totals[$bg[‘code’]][$objtype]+1;<br>\n    }<br>\n    if($o[‘owner’] == “Red”)   { $r[‘tick’] = $r[‘tick’] + $ptsaward; }<br>\n    if($o[‘owner’] == “Green”) { $g[‘tick’] = $g[‘tick’] + $ptsaward; }<br>\n    if($o[‘owner’] == “Blue”)  { $b[‘tick’] = $b[‘tick’] + $ptsaward; }<br>\n  }<br>\n}<br>\n$gb_sc     = $totals[‘gb’][‘sc’];<br>\n$gb_towers = $totals[‘gb’][‘tower’];<br>\n$gb_keeps  = $totals[‘gb’][‘keep’];<br>\n$gb_pts    = ($gb_sc*5) + ($gb_towers*10) + ($gb_keeps*25);</p>\n<p>$bb_sc     = $totals[‘bb’][‘sc’];<br>\n$bb_towers = $totals[‘bb’][‘tower’];<br>\n$bb_keeps  = $totals[‘bb’][‘keep’];<br>\n$bb_pts    = ($bb_sc*5) + ($bb_towers*10) + ($bb_keeps*25);</p>\n<p>$rb_sc     = $totals[‘rb’][‘sc’];<br>\n$rb_towers = $totals[‘rb’][‘tower’];<br>\n$rb_keeps  = $totals[‘rb’][‘keep’];<br>\n$rb_pts    = ($rb_sc*5) + ($rb_towers*10) + ($rb_keeps*25);</p>\n<p>$eb_sc      = $totals[‘eb’][‘sc’];<br>\n$eb_towers  = $totals[‘eb’][‘tower’];<br>\n$eb_keeps   = $totals[‘eb’][‘keep’];<br>\n$eb_castles = $totals[‘eb’][‘castle’];<br>\n$eb_pts     = ($eb_sc*5) + ($eb_towers*10) + ($eb_keeps*25) + ($eb_castles*35);</p></div></blockquote>\n<p>Then just take the values and do what you like with them. I insert them into a database. I also cron job the script to run every 15 minutes.</p>","arenanet":false},{"pubDate":"2013-05-30T08:47:12.000Z","guid":"http://forum-en.guildwars2.com/forum/community/api/WvW-API-and-Website-Question/2119718","author":"Foghladha.2506","body":"\n<p>Yes. I first pull the world list and build an array of $world which will act as a World ID to Name Converter</p>\n<blockquote><div class=\"quotey\"><p>$ch = curl_init();<br>\ncurl_setopt($ch, CURLOPT_URL, “<a href=\"https://api.guildwars2.com/v1/world_names.json\">https://api.guildwars2.com/v1/world_names.json</a>”);<br>\ncurl_setopt($ch, CURLOPT_HEADER, 0);<br>\ncurl_setopt($ch, CURLOPT_RETURNTRANSFER, 1);<br>\n$curlRes = curl_exec($ch);<br>\ncurl_close($ch);<br>\n$w = json_decode($curlRes, true);<br>\n$world = array();<br>\nforeach ($w as &amp;$v) {<br>\n  $wid = $v[‘id’];<br>\n  $world[$wid] = $v[‘name’];<br>\n}<br>\nunset($v);</p></div></blockquote>\n<p>I then find the Match that my server (1013) is in.</p>\n<blockquote><div class=\"quotey\"><p>$ch = curl_init();<br>\ncurl_setopt($ch, CURLOPT_URL, “<a href=\"https://api.guildwars2.com/v1/wvw/matches.json\">https://api.guildwars2.com/v1/wvw/matches.json</a>”);<br>\ncurl_setopt($ch, CURLOPT_HEADER, 0);<br>\ncurl_setopt($ch, CURLOPT_RETURNTRANSFER, 1);<br>\n$curlRes = curl_exec($ch);<br>\ncurl_close($ch);<br>\n$wld = json_decode($curlRes, true);<br>\nforeach ($wld[‘wvw_matches’] as &amp;$v) {<br>\n  if($v[‘red_world_id’] == ‘1013’ || $v[‘blue_world_id’] == ‘1013’ || $v[‘green_world_id’] == ‘1013’) { <br>\n    $sormatch = $v[‘wvw_match_id’]; <br>\n    $r[‘id’] = $v[‘red_world_id’];<br>\n    $b[‘id’] = $v[‘blue_world_id’];<br>\n    $g[‘id’] = $v[‘green_world_id’];<br>\n  }<br>\n}<br>\nunset($v);</p></div></blockquote>\n<p>Then I build the Objective Array</p>\n<blockquote><div class=\"quotey\"><p>$ch = curl_init();<br>\ncurl_setopt($ch, CURLOPT_URL, “<a href=\"https://api.guildwars2.com/v1/wvw/objective_names.json\">https://api.guildwars2.com/v1/wvw/objective_names.json</a>”);<br>\ncurl_setopt($ch, CURLOPT_HEADER, 0);<br>\ncurl_setopt($ch, CURLOPT_RETURNTRANSFER, 1);<br>\n$curlRes = curl_exec($ch);<br>\ncurl_close($ch);<br>\n$obj = json_decode($curlRes, true);<br>\n$objective = array();<br>\nforeach ($obj as &amp;$v) {<br>\n  $objid = $v[‘id’];<br>\n  $objective[$objid] = $v[‘name’];<br>\n}<br>\nunset($v);</p></div></blockquote>","arenanet":false},{"pubDate":"2013-05-29T10:28:47.000Z","guid":"http://forum-en.guildwars2.com/forum/community/api/WvW-API-and-Website-Question/2113065","author":"Cruzyo.7304","body":"\n<p>my guess by looking at it.<br>\nThey read the information from the API every 15 minutes and save it into a database.</p>\n<p>the API is basically a live-feed. If you want to review stuff from an earlier point, you need to set that up yourself and</p>\n<p>so what do you need:<br>\na database where you can save the information, the more details you want the larger the database will be.</p>\n<p>Looking at them again, i’d assume a structure like this:<br>\nid (because you always use a id)<br>\ntimestamp<br>\ngreen_score<br>\nblue_score<br>\nred_score<br>\ngw_camps (gw=green world)<br>\ngw_towers<br>\ngw_keeps<br>\nbw_camps (bw=blue world)<br>\nbw_towers<br>\nbw_keeps<br>\nrw_camps (rw=red world)<br>\nrw_towers<br>\nrw_keeps<br>\neb_camps (eb=eternal battlegrounds)<br>\neb_towers<br>\neb_keeps<br>\neb_sm</p>\n<p>this would be all you need to store in a database to display it there.</p>\n<p>next step would be the analysis of the API with a script, but at this point my knowledge ends, im not a coder, I can do database level stuff but not alot more than that, sadly ^^</p>\n<p>but what would this script need to do?</p>\n<p>First off, read the API the way you want, the first step would be letting the script figure out what color you are (unless you want to change the script every week) and what tier you’re in</p>\n<p>so basically put a request to the <a href=\"https://api.guildwars2.com/v1/wvw/matches.json\">https://api.guildwars2.com/v1/wvw/matches.json</a> and let it return you the match_id and the color of your server_id.</p>\n<p>This way you gain access to the <a href=\"https://forum-en.guildwars2.com/external?l=https%3A%2F%2Fapi.guildwars2.com%2Fv1%2Fwvw%2Fmatch_details.json\">https://forum-en.guildwars2.com/external?l=https%3A%2F%2Fapi.guildwars2.com%2Fv1%2Fwvw%2Fmatch_details.json</a></p>\n<p>the match_id will tell you what match you’re going to look at, the color will tell you what you need to sum it.</p>\n<p>but as i said, for more advanced techniques i cannot help, i only know this stuff in theory :P</p>\n<p>second step would be to take the sums of the variables and store them into the database. that can be done with php indeed.</p>","arenanet":false}]}