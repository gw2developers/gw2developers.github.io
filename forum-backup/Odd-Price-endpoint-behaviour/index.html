<!DOCTYPE html>
<html lang="en">

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Odd Price endpoint behaviour</title>
  <meta name="description" content="Learn how to use the GW2 API.">

  <link rel="stylesheet" href="/assets/main.css">
  <link rel="canonical" href="/forum-backup/Odd-Price-endpoint-behaviour/">
  <link rel="alternate" type="application/rss+xml" title="GW2 Developers" href="/feed.xml">
  
  
  <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-106748097-1', 'auto');
  ga('send', 'pageview');

</script>
  

  
</head>


  <body>

    <header class="site-header" role="banner">

  <div class="wrapper">
    
    
    <a class="site-title" href="/"><img src="/assets/images/logo.svg"></a>
  
    
      <nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
              <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
              <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger">
          
            
            
          
            
            
            <a class="page-link" href="/forum-backup/">Forum Backup</a>
            
          
            
            
            <a class="page-link" href="/guides/">Guides</a>
            
          
            
            
          
            
            
          
            
            
          
        </div>
      </nav>
    
  </div>
</header>

    <main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post">

  <header class="post-header">
    <h1 class="post-title">Odd Price endpoint behaviour</h1>
  </header>

  <div class="post-content">
    


<p class="post-meta">
    Original Url: http://forum-en.guildwars2.com/forum/community/api/Odd-Price-endpoint-behaviour
</p>



<h2 id="">Ravenhearte.5913:</h2>
<p class="post-meta">
    <time datetime="2015-08-18T01:20:49+00:00">
        18 Aug 2015
    </time>
</p>
<p>
<p>Hey people,</p>
<p>So, when querying the price endpoint for ids, I get back a list of 22581 ids. When I page in the endpoint, I end up with 22557 objects. I checked page 112, and it had 181 objects, which seemed odd, I then consoled out the total objects in each page as it was read in, page 76 returns 195 objects, page 78 : 181. Is there a reason for these missing 24 objects? Shouldn’t all valid ids be represented in the returned objects? Basically, is this a bug, or a “feature”?</p></p>

<h2 id="">SingerOfTheFall.3546:</h2>
<p class="post-meta">
    <time datetime="2015-08-18T08:28:19+00:00">
        18 Aug 2015
    </time>
</p>
<p>
<p>Which IDs did not return any info? You can try to get information about them via the items endpoint, and check what items are those exactly. As a wild guess, those might be the items that are potentially sell-able, but have never been obtained by the players (e.g. items that are not available in the game yet).</p></p>

<h2 id="">Ravenhearte.5913:</h2>
<p class="post-meta">
    <time datetime="2015-08-18T09:19:08+00:00">
        18 Aug 2015
    </time>
</p>
<p>
<p>It was my understanding that only items that have been found in the game are added to the endpoints. Specifically, I was under the impression that only items that have been listed for sale enter the commerce endpoints. So that solution seems improbable. I’m about to head to bed, but if no one has an answer tomorrow, I’ll write up an algorithm to find the specific ids that are missing.</p></p>

<h2 id="">Lawton Campbell.8517:</h2>
<p class="post-meta">
    <time datetime="2015-08-18T17:31:20+00:00">
        18 Aug 2015
    </time>
</p>
<p>
<p>So… /v2/items and /v2/commerce are backed by completely different databases. I guess technically /v2/items isn’t backed by a database, it’s backed by the .dat file. /v2/items also has a manually-maintained whitelist in it so it doesn’t spill the beans on everything; that whitelist doesn’t talk to the /v2/commerce database.</p>
<p>It’s possible that there are just items missing from the whitelist, or it’s possible that there’s just some weird stuff in the /v2/commerce database. There was a historical bug wherein users could place buy orders for arbitrary item ids regardless of their validity; I think that was all cleaned up but there might be some remaining detritus?</p>
<p>In any case, the inconsistency is a known fun bit that we’ll probably never fix.</p></p>

<h2 id="">Ravenhearte.5913:</h2>
<p class="post-meta">
    <time datetime="2015-08-18T20:36:29+00:00">
        18 Aug 2015
    </time>
</p>
<p>
<p>That kind of sucks. I was using the count of the ids returned to determine when I had finished paging in the objects, which works fine for the item and recipe endpoints. Back to the drawing board I guess.</p></p>

<h2 id="">Lawton Campbell.8517:</h2>
<p class="post-meta">
    <time datetime="2015-08-18T21:41:25+00:00">
        18 Aug 2015
    </time>
</p>
<p>
<blockquote><div class="citey"><cite title="Posted on August 18 2015 08:36PM"><a href="/forum/community/api/Odd-Price-endpoint-behaviour/5395057">Ravenhearte.5913:</a></cite></div><div class="quotey"><p>That kind of sucks. I was using the count of the ids returned to determine when I had finished paging in the objects, which works fine for the item and recipe endpoints. Back to the drawing board I guess.</p></div></blockquote>
<p>We might have it fixed at some point, but pagination should still work using the X-Page-Total response header. It’ll always have the same number of pages, you just might not get the full count for each page (the broken objects will be omitted and you’ll get a 206 status code instead of 200). Alternatively, the Link header has an <a href="https://tools.ietf.org/html/rfc5988#section-5">RFC5988</a>-formatted datum that contains a URL to the next page — when there’s no ‘next’ link you’re at the end.</p>
<p>Totally agree that it’s a massive annoyance though, it just happens to be in a lower-level component that I’m not really familiar with so I can’t go in and fix it myself <img src="/include/images/smilies/sad.png"></p></p>

<h2 id="">Ravenhearte.5913:</h2>
<p class="post-meta">
    <time datetime="2015-08-19T00:05:29+00:00">
        19 Aug 2015
    </time>
</p>
<p>
<p>I’m actually getting 200 codes on all pages, but I can compare X-RESULT-COUNT against what I am expecting to find pages with discrepancies. The trick would seem to be to figure out which ids are missing on a per page basis, as I’m running the loading in coroutines and can’t be guaranteed the order the pages are finishing. If I could do that I could delete them from the master idList and then be back to being able to compare that count to total objects loaded so I know when all coroutines have finished. As a hack, I guess I could create an independent count variable that starts with the count from idList, then I could simply subtract the calculated discrepancy amounts, but that’s so hack-ish. Would rather find a more elegant solution.</p></p>

<h2 id="">Ravenhearte.5913:</h2>
<p class="post-meta">
    <time datetime="2015-08-19T02:22:52+00:00">
        19 Aug 2015
    </time>
</p>
<p>
<p>For those curious, ids affected are:</p>
<p>31113 31120 31124 31127 31130 31131 31132 31133 31135 31136 31137 31139 31140 31144 31167 31168 31169 31175 31178 29952 29960 29964 29974 29978</p>
<p>I dealt with them by searching for the first objects id in the master idList, grabbing a range of 200, and then taking that sublist and removing all ids that successfully returned objects, I then deleted the ids that remained from the master idList.</p></p>

<h2 id="">Lawton Campbell.8517:</h2>
<p class="post-meta">
    <time datetime="2015-08-19T17:09:05+00:00">
        19 Aug 2015
    </time>
</p>
<p>
<p>Cool, thanks for looking those up. As a temporary workaround, I’m going to blacklist those ids from appearing in the id list. Won’t fix the root of the problem but it’ll be something.</p></p>

<h2 id="">Lawton Campbell.8517:</h2>
<p class="post-meta">
    <time datetime="2015-08-20T19:24:09+00:00">
        20 Aug 2015
    </time>
</p>
<p>
<blockquote><div class="citey"><cite title="Posted on August 19 2015 02:22AM"><a href="/forum/community/api/Odd-Price-endpoint-behaviour/5395771">Ravenhearte.5913:</a></cite></div><div class="quotey"><p>For those curious, ids affected are:</p>
<p>31113 31120 31124 31127 31130 31131 31132 31133 31135 31136 31137 31139 31140 31144 31167 31168 31169 31175 31178 29952 29960 29964 29974 29978</p></div></blockquote>
<p>These ids should now all be blacklisted. They won’t be returned from /v2/commerce/listings anymore.</p></p>

<h2 id="">Chokapik.3741:</h2>
<p class="post-meta">
    <time datetime="2015-08-21T09:50:56+00:00">
        21 Aug 2015
    </time>
</p>
<p>
<p>I just found a similar issue in v2/skins.<br>
<a href="https://api.guildwars2.com/v2/skins">This page</a> returns a total of 3520 skin ids.<br>
However, when trying to request data for all of these ids, I end up with 3519 objects.</p>
<p>The skin causing the issue seems to be id=2984.<br>
<a href="https://api.guildwars2.com/v2/skins/2984">https://api.guildwars2.com/v2/skins/2984</a></p>
<p>Edit: I also wrote a quick <a href="http://jsfiddle.net/4xx2324m/1">jsfiddle</a> that could be handy when we have these kinds of problems. By changing the URL at the top of the script, you can check the other endpoints as well (I checked some of them, haven’t found any issues so far).</p></p>


  </div>

</article>

      </div>
    </main>

    <footer class="site-footer">

  <div class="wrapper">

    <h2 class="footer-heading">GW2 Developers</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li>
            
              GW2 Developers
            
            </li>
            
            <li><a href="mailto:gw2developers@darthmaim.de">gw2developers@darthmaim.de</a></li>
            
        </ul>
      </div>

      <div class="footer-col footer-col-2">
        <ul class="social-media-list">
          
          <li>
            <a href="https://github.com/gw2developers"><span class="icon icon--github"><svg viewBox="0 0 16 16" width="16px" height="16px"><path fill="#828282" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761 c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32 c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472 c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037 C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65 c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261 c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082 c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129 c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"/></svg>
</span><span class="username">gw2developers</span></a>

          </li>
          

          
          <li>
            <a href="https://twitter.com/gw2api"><span class="icon icon--twitter"><svg viewBox="0 0 16 16" width="16px" height="16px"><path fill="#828282" d="M15.969,3.058c-0.586,0.26-1.217,0.436-1.878,0.515c0.675-0.405,1.194-1.045,1.438-1.809c-0.632,0.375-1.332,0.647-2.076,0.793c-0.596-0.636-1.446-1.033-2.387-1.033c-1.806,0-3.27,1.464-3.27,3.27 c0,0.256,0.029,0.506,0.085,0.745C5.163,5.404,2.753,4.102,1.14,2.124C0.859,2.607,0.698,3.168,0.698,3.767 c0,1.134,0.577,2.135,1.455,2.722C1.616,6.472,1.112,6.325,0.671,6.08c0,0.014,0,0.027,0,0.041c0,1.584,1.127,2.906,2.623,3.206 C3.02,9.402,2.731,9.442,2.433,9.442c-0.211,0-0.416-0.021-0.615-0.059c0.416,1.299,1.624,2.245,3.055,2.271 c-1.119,0.877-2.529,1.4-4.061,1.4c-0.264,0-0.524-0.015-0.78-0.046c1.447,0.928,3.166,1.469,5.013,1.469 c6.015,0,9.304-4.983,9.304-9.304c0-0.142-0.003-0.283-0.009-0.423C14.976,4.29,15.531,3.714,15.969,3.058z"/></svg>
</span><span class="username">gw2api</span></a>

          </li>
          
        </ul>
      </div>

      <div class="footer-col footer-col-3">
        <p>Learn how to use the GW2 API.
</p>
      </div>
    </div>

  </div>

</footer>


  </body>

</html>
