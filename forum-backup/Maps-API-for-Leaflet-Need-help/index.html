<!DOCTYPE html>
<html lang="en">

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Maps API for Leaflet. Need help.</title>
  <meta name="description" content="Learn how to use the GW2 API.">

  <link rel="stylesheet" href="/assets/main.css">
  <link rel="canonical" href="/forum-backup/Maps-API-for-Leaflet-Need-help/">
  <link rel="alternate" type="application/rss+xml" title="GW2 Developers" href="/feed.xml">
  
  
  <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-106748097-1', 'auto');
  ga('send', 'pageview');

</script>
  

  
</head>


  <body>

    <header class="site-header" role="banner">

  <div class="wrapper">
    
    
    <a class="site-title" href="/"><img src="/assets/images/logo.svg"></a>
  
    
      <nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
              <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
              <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger">
          
            
            
          
            
            
            <a class="page-link" href="/forum-backup/">Forum Backup</a>
            
          
            
            
            <a class="page-link" href="/guides/">Guides</a>
            
          
            
            
          
            
            
          
            
            
          
        </div>
      </nav>
    
  </div>
</header>

    <main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post">

  <header class="post-header">
    <h1 class="post-title">Maps API for Leaflet. Need help.</h1>
  </header>

  <div class="post-content">
    


<p class="post-meta">
    Original Url: http://forum-en.guildwars2.com/forum/community/api/Maps-API-for-Leaflet-Need-help
</p>



<h2 id="">ezd.6359:</h2>
<p class="post-meta">
    <time datetime="2015-07-08T05:07:25+00:00">
        08 Jul 2015
    </time>
</p>
<p>
<p>Lost two days. Can’t understand what to do :/ Help?</p>
<p><strong>1) How to determine right coords/bounds? I want to change focus of the map with java scripts outside of the map.</strong></p>
<p>For example i load <a href="https://api.guildwars2.com/v2/continents/1/floors/1">https://api.guildwars2.com/v2/continents/1/floors/1</a> it looks like right place to show Tyria.</p>
<p>I can use sectors coords to focus the map in right position.</p>
<pre><code>
var bounds=new L.LatLngBounds(
    this.map.unproject([0,32768],max_zoom),
    this.map.unproject([32768, 0],max_zoom)
);
this.map.setMaxBounds(bounds);
...
this.map.setView(pos);
this.map.panTo(this.map.unproject(pos,zoom)).setZoom(zoom);
</code></pre>
<p>…</p>
<p>If i try to use “clamp” (continent_rect of the map), i can’t focus to right position.</p>
<pre><code>
var bounds=new L.LatLngBounds(
    this.map.unproject([continent_rect[0][0],continent_rect[0][1]],max_zoom),
    this.map.unproject([continent_rect[1][0],continent_rect[1][1]],max_zoom)
).pad(0.2);
this.map.setMaxBounds(bounds);
...
this.map.setView(pos);
this.map.panTo(this.map.unproject(pos,zoom)).setZoom(zoom);
</code></pre>
<p>…<br>
… sectors coords move the map to wrong place. I don’t understand it. How to translate maps api coords/map_rect/continent_rect to right form (for leaflet)?</p>
<p><strong>2) How to show right map names? Or how to show maps from different regions?</strong></p>
<p>a) Since API does not provide “label_coords” for map names i try to calculate right position using continent_rect. It works, but some regions have too many maps (and names), it makes “map name” unusable because they lie in same place. How to filter wrong names?<br>
</p><pre><code>
X=(info['continent_rect'][1][0]-info['continent_rect'][0][0])/2+info['continent_rect'][0][0],
Y=(info['continent_rect'][1][1]-info['continent_rect'][0][1])/2+info['continent_rect'][0][1]
</code></pre>For example i use “continent/1/floor/1”. Region=8 has many maps and it fail everything. All these names lie in same place (corresponding map).<p></p>
<p><a href="https://api.guildwars2.com/v2/continents/1/floors/1/regions/8">https://api.guildwars2.com/v2/continents/1/floors/1/regions/8</a><br>
It looks like it: <a href="http://i.gyazo.com/e25894fbd3bfd4e4828e15be544df413.png">http://i.gyazo.com/e25894fbd3bfd4e4828e15be544df413.png</a></p>
<p><strong>3) How to show those maps from region 8? They have same parameters (continent/floor/rect) as normal maps.</strong></p>
<p>How to filter dungeons or special events maps etc?</p>
<p>I need (only default floors):<br>
- Tyria maps <br>
- Main dungeons<br>
- WvWvW</p>
<p><strong>4) Is there any list/API that can map GW2 API info -&gt; usuable info?<img src="/include/images/smilies/smile.png"></strong></p>
<p>Like:<br>
</p><pre><code>
Tyria:{
    regions{
        maps: {
            continent_id=1
            floor_id=1
            center=coords
            default_zoom=X
            label_coords=coords
            ...
        }
    }
}
Duangeons:{
    maps: {
        Ascalonian Catacoms
             ...
    }
}
</code></pre><p></p>
<p>All items should be in one instance. At this moment API provides duplicate names. For example<br>
<a href="https://api.guildwars2.com/v2/continents/1/floors/-2/regions/2/maps/33">https://api.guildwars2.com/v2/continents/1/floors/-2/regions/2/maps/33</a><br>
<a href="https://api.guildwars2.com/v2/continents/1/floors/-2/regions/2/maps/36">https://api.guildwars2.com/v2/continents/1/floors/-2/regions/2/maps/36</a></p>
<p>Which is right? How to understand it automatically without having special lists of ids, continents, floors etc?</p></p>

<h2 id="">smiley.1438:</h2>
<p class="post-meta">
    <time datetime="2015-07-08T15:06:56+00:00">
        08 Jul 2015
    </time>
</p>
<p>
<p>This forum’s software sucks. &lt;.&lt;<br>
It sucks so hard that i’ve written my reply in markdown.</p>
<p><a href="https://gist.github.com/codemasher/50d75a36d28558231a92">https://gist.github.com/codemasher/50d75a36d28558231a92</a></p>
<p>(yes, i’m desperate)</p></p>

<h2 id="">ezd.6359:</h2>
<p class="post-meta">
    <time datetime="2015-07-08T23:23:25+00:00">
        08 Jul 2015
    </time>
</p>
<p>
<p>Thx! I will try to adapt my code.</p>
<p>It seems i need to make my own list of continents/floors/regions/maps.</p>
<p>One more question: is it possible to restrict leaflet from zooming out of “max bounds”? It is working in old version of leaflet by default<br>
leaflet.js (0.5.1) <a href="http://jsfiddle.net/cliff/CRRGC/">http://jsfiddle.net/cliff/CRRGC/</a><br>
Latest stable version is 0.7.3 – <a href="https://jsfiddle.net/CRRGC/947/">https://jsfiddle.net/CRRGC/947/</a> – you can zoom to max.</p></p>

<h2 id="">smiley.1438:</h2>
<p class="post-meta">
    <time datetime="2015-07-09T17:00:48+00:00">
        09 Jul 2015
    </time>
</p>
<p>
<blockquote><div class="citey"><cite title="Posted on July 08 2015 11:23PM"><a href="/forum/community/api/Maps-API-for-Leaflet-Need-help/5262388">ezd.6359:</a></cite></div><div class="quotey"><p>One more question: is it possible to restrict leaflet from zooming out of “max bounds”? It is working in old version of leaflet by default</p></div></blockquote>
<p>I’m pretty sure that was the <del>feature</del> bug which caused the map to jump on the screen on low zoom levels when it was smaller than the element which contained it. This has been fixed in more recent versions.</p>
<p>Edit: here’s an example: <a href="http://gw2.chillerlan.net/examples/gw2-maps-leaflet.html">http://gw2.chillerlan.net/examples/gw2-maps-leaflet.html</a></p></p>

<h2 id="">ezd.6359:</h2>
<p class="post-meta">
    <time datetime="2015-07-10T16:33:46+00:00">
        10 Jul 2015
    </time>
</p>
<p>
<p>Bug? Hehe. I think it is a nice thing<img src="/include/images/smilies/smile.png"> Much better than useless grey background. So, should i write my own code to reproduce this “bug” or leaflet has an option for it?</p></p>


  </div>

</article>

      </div>
    </main>

    <footer class="site-footer">

  <div class="wrapper">

    <h2 class="footer-heading">GW2 Developers</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li>
            
              GW2 Developers
            
            </li>
            
            <li><a href="mailto:gw2developers@darthmaim.de">gw2developers@darthmaim.de</a></li>
            
        </ul>
      </div>

      <div class="footer-col footer-col-2">
        <ul class="social-media-list">
          
          <li>
            <a href="https://github.com/gw2developers"><span class="icon icon--github"><svg viewBox="0 0 16 16" width="16px" height="16px"><path fill="#828282" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761 c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32 c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472 c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037 C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65 c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261 c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082 c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129 c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"/></svg>
</span><span class="username">gw2developers</span></a>

          </li>
          

          
          <li>
            <a href="https://twitter.com/gw2api"><span class="icon icon--twitter"><svg viewBox="0 0 16 16" width="16px" height="16px"><path fill="#828282" d="M15.969,3.058c-0.586,0.26-1.217,0.436-1.878,0.515c0.675-0.405,1.194-1.045,1.438-1.809c-0.632,0.375-1.332,0.647-2.076,0.793c-0.596-0.636-1.446-1.033-2.387-1.033c-1.806,0-3.27,1.464-3.27,3.27 c0,0.256,0.029,0.506,0.085,0.745C5.163,5.404,2.753,4.102,1.14,2.124C0.859,2.607,0.698,3.168,0.698,3.767 c0,1.134,0.577,2.135,1.455,2.722C1.616,6.472,1.112,6.325,0.671,6.08c0,0.014,0,0.027,0,0.041c0,1.584,1.127,2.906,2.623,3.206 C3.02,9.402,2.731,9.442,2.433,9.442c-0.211,0-0.416-0.021-0.615-0.059c0.416,1.299,1.624,2.245,3.055,2.271 c-1.119,0.877-2.529,1.4-4.061,1.4c-0.264,0-0.524-0.015-0.78-0.046c1.447,0.928,3.166,1.469,5.013,1.469 c6.015,0,9.304-4.983,9.304-9.304c0-0.142-0.003-0.283-0.009-0.423C14.976,4.29,15.531,3.714,15.969,3.058z"/></svg>
</span><span class="username">gw2api</span></a>

          </li>
          
        </ul>
      </div>

      <div class="footer-col footer-col-3">
        <p>Learn how to use the GW2 API.
</p>
      </div>
    </div>

  </div>

</footer>


  </body>

</html>
