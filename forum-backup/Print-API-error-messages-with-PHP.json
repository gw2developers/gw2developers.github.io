{"title":"Print API error messages with PHP","pubDate":"2015-07-02T20:33:56.000Z","guid":"http://forum-en.guildwars2.com/forum/community/api/Print-API-error-messages-with-PHP","comments":[{"pubDate":"2015-07-09T11:53:03.000Z","guid":"http://forum-en.guildwars2.com/forum/community/api/Print-API-error-messages-with-PHP/5263650","author":"darthmaim.6017","body":"\n<blockquote><div class=\"citey\"><cite title=\"Posted on July 03 2015 09:07AM\"><a href=\"/forum/community/api/Print-API-error-messages-with-PHP/5243159\">darthmaim.6017:</a></cite></div><div class=\"quotey\"><p>I will throw some more documentation with some better examples for my wrapper up over the weekend</p></div></blockquote>\n<p>Took a little bit longer, but its there now: <a href=\"https://github.com/GW2Treasures/gw2api#usage\">https://github.com/GW2Treasures/gw2api#usage</a></p>","arenanet":false},{"pubDate":"2015-07-03T09:07:11.000Z","guid":"http://forum-en.guildwars2.com/forum/community/api/Print-API-error-messages-with-PHP/5243159","author":"darthmaim.6017","body":"\n<p>curl is the right way to go, you can check the status code and the potential error message to determine if the result is ok. I also recommend guzzle on top of curl, it’s easy to make multiple parallel requests (instead of working with curl_multi directly).</p>\n<blockquote><div class=\"citey\"><cite title=\"Posted on July 02 2015 11:23PM\"><a href=\"/forum/community/api/Print-API-error-messages-with-PHP/5242045\">Vermil Rockrim.9756:</a></cite></div><div class=\"quotey\"><p>I’m aware about wrappers, but there are so many on the wiki and I couldn’t decide on which one. Since you are offering yours, I will assume yours is the best and most up to date and will gladly use it once I finish understanding this thing called API<img src=\"/include/images/smilies/colondee.png\"></p></div></blockquote>\n<p>Doing it yourself first is a great way to learn how it works! But we don’t have to make it harder on ourselves by reinventing the wheel every time<img src=\"/include/images/smilies/smile.png\"></p>\n<p>I really don’t want to advertise my wrapper, but most wrappers on the wiki are still using the old v1 API and/or don’t support the authenticated endpoints. I’d say try some out and use the one that you like the most. (I will throw some more documentation with some better examples for my wrapper up over the weekend)</p>","arenanet":false},{"pubDate":"2015-07-03T08:33:27.000Z","guid":"http://forum-en.guildwars2.com/forum/community/api/Print-API-error-messages-with-PHP/5243111","author":"smiley.1438","body":"\n<blockquote><div class=\"citey\"><cite title=\"Posted on July 02 2015 11:09PM\"><a href=\"/forum/community/api/Print-API-error-messages-with-PHP/5241994\">Vermil Rockrim.9756:</a></cite></div><div class=\"quotey\"><blockquote><div class=\"citey\"><cite title=\"Posted on July 02 2015 08:56PM\"><a href=\"/forum/community/api/Print-API-error-messages-with-PHP/5241549\">smiley.1438:</a></cite></div><div class=\"quotey\"><p>It seems that file_get_contents() fails as soon as it gets the HTTP/403 and doesn’t receive the content.</p>\n<blockquote><div class=\"quotey\"><p>The function returns the read data or FALSE on failure.</p></div></blockquote>\n<p>Try using cURL instead. <br>\nSee: <a href=\"https://github.com/codemasher/gw2-database/blob/master/classes/gw2api.class.php#L130\">https://github.com/codemasher/gw2-database/blob/master/classes/gw2api.class.php#L130</a></p></div></blockquote>\n<p>Thank you, I have been using cURL to no avail but after looking at your link noticed some missing constants, and a ‘CA root certificate file’ that was needed to .. make the SSL work? I don’t know much about that, but I’m happy with the results. The working code is the following:</p>\n<p>$url = “<a href=\"https://api.guildwars2.com/v2/characters\">https://api.guildwars2.com/v2/characters</a>”;<br>\n$ch = curl_init();<br>\ncurl_setopt_array($ch, [<br>\n\t\t\tCURLOPT_URL            =&gt; $url,<br>\n\t\t\tCURLOPT_SSL_VERIFYPEER =&gt; true,<br>\n\t\t\tCURLOPT_SSL_VERIFYHOST =&gt; 2,<br>\n\t\t\tCURLOPT_CAINFO         =&gt; getcwd().“\\cacert.pem”,<br>\n\t\t\tCURLOPT_RETURNTRANSFER =&gt; true]);<br>\n$output = curl_exec($ch);<br>\ncurl_close($ch);<br>\necho $output;</p>\n<p>I got the certificate from here <a href=\"http://curl.haxx.se/ca/cacert.pem\">http://curl.haxx.se/ca/cacert.pem</a><br>\nThanks for your guidance, this was driving me nuts.</p></div></blockquote>\n<p>The missing variables are all in the code i linked, along with a link to the root certificates (which are indeed needed to “make SSL work”)<img src=\"/include/images/smilies/wink.png\"><br>\n<a href=\"https://github.com/codemasher/gw2-database/blob/master/classes/gw2api.class.php#L65\">https://github.com/codemasher/gw2-database/blob/master/classes/gw2api.class.php#L65</a></p>\n<p>Glad you found it anyway and it worked for you!</p>\n<blockquote><div class=\"citey\"><cite title=\"Posted on July 03 2015 12:59AM\"><a href=\"/forum/community/api/Print-API-error-messages-with-PHP/5242290\">fishball.7204:</a></cite></div><div class=\"quotey\"><p>You can check if $data returns null.</p></div></blockquote>\n<p>It won’t return <strong>null</strong>. Ever. It will return a boolean <strong>false</strong> or a string containing the response (which may be empty) – that makes a slight difference.</p>","arenanet":false},{"pubDate":"2015-07-03T00:59:11.000Z","guid":"http://forum-en.guildwars2.com/forum/community/api/Print-API-error-messages-with-PHP/5242290","author":"fishball.7204","body":"\n<blockquote><div class=\"citey\"><cite title=\"Posted on July 02 2015 08:33PM\"><a href=\"/forum/community/api/Print-API-error-messages-with-PHP/5241447\">Vermil Rockrim.9756:</a></cite></div><div class=\"quotey\"><p>Hello, I’m not able to print error messages like <br>\n“requires scope characters” or <br>\n“endpoint requires authentication” with PHP. If anyone can help me with this I’ll be grateful. I have the following code:</p>\n<p>$apiV2 = “<a href=\"https://api.guildwars2.com/v2/characters\">https://api.guildwars2.com/v2/characters</a>”;<br>\n$json = file_get_contents($apiV2);<br>\n$data = json_decode($json);<br>\necho $data-&gt;text;</p>\n<p>Expected result using that url would be {\"text\":“endpoint requires authentication”}, however I’m only getting warnings from PHP stating that it ‘failed to open steam: HTTP request failed! 403 forbidden’ and that the $data var is empty.</p>\n<p>How could I achieve this? Querying a valid API url display info correctly, but I would like to be able to store and print more accurate error messages in case something goes wrong.</p></div></blockquote>\n<p>You can check if $data returns null. Right now there’s only 3 use cases, key is invalid, key does not give permission to XYZ and key is valid. You can check if key is valid using the tokeninfo API if it returns null = invalid key and if it returns null on the others but not tokeninfo it means that the key is not allowed to view XYZ.</p>\n<p>This assumes you want to stick with file_get_contents and is kinda a workaround. Otherwise, use cURL for the best results.</p>","arenanet":false},{"pubDate":"2015-07-02T23:23:57.000Z","guid":"http://forum-en.guildwars2.com/forum/community/api/Print-API-error-messages-with-PHP/5242045","author":"Vermil Rockrim.9756","body":"\n<blockquote><div class=\"citey\"><cite title=\"Posted on July 02 2015 09:16PM\"><a href=\"/forum/community/api/Print-API-error-messages-with-PHP/5241614\">darthmaim.6017:</a></cite></div><div class=\"quotey\"><p>Or you could use my API wrapper that throws a AuthenticationException with a correct reason. <a href=\"https://github.com/gw2treasures/gw2api\">https://github.com/gw2treasures/gw2api</a></p>\n<p>(I have to add better documentation for that still)</p>\n<p>—</p>\n<p>Your example would be:<br>\n</p><pre><code>$api = new GW2Api()\ntry {\n    $characters = $api-&amp;gt;characters('api_key')-&amp;gt;all();\n} catch(AuthenticationException $exception) {\n    // echo error message\n    echo $exception-&amp;gt;getMessage();\n}</code></pre><p></p></div></blockquote>\n<p>I’m aware about wrappers, but there are so many on the wiki and I couldn’t decide on which one. Since you are offering yours, I will assume yours is the best and most up to date and will gladly use it once I finish understanding this thing called API<img src=\"/include/images/smilies/colondee.png\"></p>","arenanet":false},{"pubDate":"2015-07-02T23:09:17.000Z","guid":"http://forum-en.guildwars2.com/forum/community/api/Print-API-error-messages-with-PHP/5241994","author":"Vermil Rockrim.9756","body":"\n<blockquote><div class=\"citey\"><cite title=\"Posted on July 02 2015 08:56PM\"><a href=\"/forum/community/api/Print-API-error-messages-with-PHP/5241549\">smiley.1438:</a></cite></div><div class=\"quotey\"><p>It seems that file_get_contents() fails as soon as it gets the HTTP/403 and doesn’t receive the content.</p>\n<blockquote><div class=\"quotey\"><p>The function returns the read data or FALSE on failure.</p></div></blockquote>\n<p>Try using cURL instead. <br>\nSee: <a href=\"https://github.com/codemasher/gw2-database/blob/master/classes/gw2api.class.php#L130\">https://github.com/codemasher/gw2-database/blob/master/classes/gw2api.class.php#L130</a></p></div></blockquote>\n<p>Thank you, I have been using cURL to no avail but after looking at your link noticed some missing constants, and a ‘CA root certificate file’ that was needed to .. make the SSL work? I don’t know much about that, but I’m happy with the results. The working code is the following:</p>\n<p>$url = “<a href=\"https://api.guildwars2.com/v2/characters\">https://api.guildwars2.com/v2/characters</a>”;<br>\n$ch = curl_init();<br>\ncurl_setopt_array($ch, [<br>\n\t\t\tCURLOPT_URL            =&gt; $url,<br>\n\t\t\tCURLOPT_SSL_VERIFYPEER =&gt; true,<br>\n\t\t\tCURLOPT_SSL_VERIFYHOST =&gt; 2,<br>\n\t\t\tCURLOPT_CAINFO         =&gt; getcwd().“\\cacert.pem”,<br>\n\t\t\tCURLOPT_RETURNTRANSFER =&gt; true]);<br>\n$output = curl_exec($ch);<br>\ncurl_close($ch);<br>\necho $output;</p>\n<p>I got the certificate from here <a href=\"http://curl.haxx.se/ca/cacert.pem\">http://curl.haxx.se/ca/cacert.pem</a><br>\nThanks for your guidance, this was driving me nuts.</p>","arenanet":false},{"pubDate":"2015-07-02T21:16:16.000Z","guid":"http://forum-en.guildwars2.com/forum/community/api/Print-API-error-messages-with-PHP/5241614","author":"darthmaim.6017","body":"\n<p>Or you could use my API wrapper that throws a AuthenticationException with a correct reason. <a href=\"https://github.com/gw2treasures/gw2api\">https://github.com/gw2treasures/gw2api</a></p>\n<p>(I have to add better documentation for that still)</p>\n<p>—</p>\n<p>Your example would be:<br>\n</p><pre><code>$api = new GW2Api()\ntry {\n    $characters = $api-&gt;characters('api_key')-&gt;all();\n} catch(AuthenticationException $exception) {\n    // echo error message\n    echo $exception-&gt;getMessage();\n}</code></pre><p></p>","arenanet":false},{"pubDate":"2015-07-02T20:56:12.000Z","guid":"http://forum-en.guildwars2.com/forum/community/api/Print-API-error-messages-with-PHP/5241549","author":"smiley.1438","body":"\n<p>It seems that file_get_contents() fails as soon as it gets the HTTP/403 and doesn’t receive the content.</p>\n<blockquote><div class=\"quotey\"><p>The function returns the read data or FALSE on failure.</p></div></blockquote>\n<p>Try using cURL instead. <br>\nSee: <a href=\"https://github.com/codemasher/gw2-database/blob/master/classes/gw2api.class.php#L130\">https://github.com/codemasher/gw2-database/blob/master/classes/gw2api.class.php#L130</a></p>","arenanet":false},{"pubDate":"2015-07-02T20:33:56.000Z","guid":"http://forum-en.guildwars2.com/forum/community/api/Print-API-error-messages-with-PHP/5241447","author":"Vermil Rockrim.9756","body":"\n<p>Hello, I’m not able to print error messages like <br>\n“requires scope characters” or <br>\n“endpoint requires authentication” with PHP. If anyone can help me with this I’ll be grateful. I have the following code:</p>\n<p>$apiV2 = “<a href=\"https://api.guildwars2.com/v2/characters\">https://api.guildwars2.com/v2/characters</a>”;<br>\n$json = file_get_contents($apiV2);<br>\n$data = json_decode($json);<br>\necho $data-&gt;text;</p>\n<p>Expected result using that url would be {\"text\":“endpoint requires authentication”}, however I’m only getting warnings from PHP stating that it ‘failed to open steam: HTTP request failed! 403 forbidden’ and that the $data var is empty.</p>\n<p>How could I achieve this? Querying a valid API url display info correctly, but I would like to be able to store and print more accurate error messages in case something goes wrong.</p>","arenanet":false}]}