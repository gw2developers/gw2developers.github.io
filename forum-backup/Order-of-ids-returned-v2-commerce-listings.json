{"title":"Order of ids returned, v2/commerce/listings","pubDate":"2014-09-13T04:48:18.000Z","guid":"http://forum-en.guildwars2.com/forum/community/api/Order-of-ids-returned-v2-commerce-listings","comments":[{"pubDate":"2014-09-25T20:48:04.000Z","guid":"http://forum-en.guildwars2.com/forum/community/api/Order-of-ids-returned-v2-commerce-listings/4445386","author":"Pat Cavit.9234","body":"\n<blockquote><div class=\"citey\"><cite title=\"Posted on September 25 2014 08:45PM\"><a href=\"/forum/community/api/Order-of-ids-returned-v2-commerce-listings/4445374\">poke.3712:</a></cite></div><div class=\"quotey\"><blockquote><div class=\"citey\"><cite title=\"Posted on September 15 2014 06:39PM\"><a href=\"/forum/community/api/Order-of-ids-returned-v2-commerce-listings/4415361\">Pat Cavit.9234:</a></cite></div><div class=\"quotey\"><p>Yup, we make a bunch of async requests for the data and simply assemble it in the order it returns.</p></div></blockquote>\n<p>Is that order consistent enough for paging though? I.e. when using the paging mechanism, can I be sure that I get <strong>every</strong> object at some point, or is it possible that some will be missed because the order for one page ended up being different than the other?</p></div></blockquote>\n<p>We start w/ the complete list of IDs for paging, so yes. Each individual page may not have a guaranteed order, but it does have a guaranteed set of IDs that will be returned.</p>","arenanet":true},{"pubDate":"2014-09-25T20:45:28.000Z","guid":"http://forum-en.guildwars2.com/forum/community/api/Order-of-ids-returned-v2-commerce-listings/4445374","author":"poke.3712","body":"\n<blockquote><div class=\"citey\"><cite title=\"Posted on September 15 2014 06:39PM\"><a href=\"/forum/community/api/Order-of-ids-returned-v2-commerce-listings/4415361\">Pat Cavit.9234:</a></cite></div><div class=\"quotey\"><p>Yup, we make a bunch of async requests for the data and simply assemble it in the order it returns.</p></div></blockquote>\n<p>Is that order consistent enough for paging though? I.e. when using the paging mechanism, can I be sure that I get <strong>every</strong> object at some point, or is it possible that some will be missed because the order for one page ended up being different than the other?</p>","arenanet":false},{"pubDate":"2014-09-18T22:22:20.000Z","guid":"http://forum-en.guildwars2.com/forum/community/api/Order-of-ids-returned-v2-commerce-listings/4426883","author":"Pat Cavit.9234","body":"\n<blockquote><div class=\"citey\"><cite title=\"Posted on September 18 2014 10:09PM\"><a href=\"/forum/community/api/Order-of-ids-returned-v2-commerce-listings/4426843\">StevenL.3761:</a></cite></div><div class=\"quotey\"><p>Oooh<img src=\"/include/images/smilies/colondee.png\"> I had no idea that nodejs works with IIS.</p></div></blockquote>\n<p>It’s not nodejs, it just works like it. We use <a href=\"https://en.wikipedia.org/wiki/Application_Request_Routing\">ARR</a> as a load-balancer and HTTPS endpoint which is why you’re thinking we use IIS.</p>","arenanet":true},{"pubDate":"2014-09-18T22:09:09.000Z","guid":"http://forum-en.guildwars2.com/forum/community/api/Order-of-ids-returned-v2-commerce-listings/4426843","author":"StevenL.3761","body":"\n<p>Oooh<img src=\"/include/images/smilies/colondee.png\"> I had no idea that nodejs works with IIS.</p>","arenanet":false},{"pubDate":"2014-09-18T21:25:54.000Z","guid":"http://forum-en.guildwars2.com/forum/community/api/Order-of-ids-returned-v2-commerce-listings/4426710","author":"Pat Cavit.9234","body":"\n<blockquote><div class=\"citey\"><cite title=\"Posted on September 18 2014 09:08AM\"><a href=\"/forum/community/api/Order-of-ids-returned-v2-commerce-listings/4424728\">StevenL.3761:</a></cite></div><div class=\"quotey\"><p>Is the public API written in .NET? You might be able to get better performance if you use <a href=\"http://msdn.microsoft.com/en-us/library/system.threading.tasks.task.whenany(v=vs.110).aspx\">Task.WhenAny()</a> to process requests as soon as they complete. Waiting for all requests to complete before handling their response means wasted CPU time. Client applications will benefit as well if they support streaming JSON while it is still being created.</p></div></blockquote>\n<p>We don’t use .NET &amp; for simplicity’s sake we don’t stream responses right now. We’re processing each individual request as soon as it completes but we’re not blocking on the responses or anything. It works like nodejs, conceptually.</p>","arenanet":true},{"pubDate":"2014-09-18T09:08:50.000Z","guid":"http://forum-en.guildwars2.com/forum/community/api/Order-of-ids-returned-v2-commerce-listings/4424728","author":"StevenL.3761","body":"\n<p>Is the public API written in .NET? You might be able to get better performance if you use <a href=\"http://msdn.microsoft.com/en-us/library/system.threading.tasks.task.whenany(v=vs.110).aspx\">Task.WhenAny()</a> to process requests as soon as they complete. Waiting for all requests to complete before handling their response means wasted CPU time. Client applications will benefit as well if they support streaming JSON while it is still being created.</p>","arenanet":false},{"pubDate":"2014-09-15T18:39:55.000Z","guid":"http://forum-en.guildwars2.com/forum/community/api/Order-of-ids-returned-v2-commerce-listings/4415361","author":"Pat Cavit.9234","body":"\n<blockquote><div class=\"citey\"><cite title=\"Posted on September 14 2014 07:08AM\"><a href=\"/forum/community/api/Order-of-ids-returned-v2-commerce-listings/4410457\">StevenL.3761:</a></cite></div><div class=\"quotey\"><p>My best guess is that listings are (lazily) loaded in parallel, so the order would be undefined. For practical purposes, that means that the list goes from listings with few offers to listings with lots of offers.</p>\n<p>No idea if that’s how it really works.</p></div></blockquote>\n<p>Yup, we make a bunch of async requests for the data and simply assemble it in the order it returns.</p>\n<p>Now, as for object-vs-array:</p>\n<p>Shoving results onto the end of an array as we get them back is easy and lets you do nice things like check the length of the array to see how many items you got back. It also means you can use useful array functionality like (JS examples) .some(), .every(), .reduce(), etc w/o first having to jump through a bunch of hoops.</p>\n<p>Constant-time lookups of a specific data ID doesn’t feel like a worthwhile trade-off for an API that is generally intended to provide bulk data, and if you did want that you could ask the API for data for the specific ID you cared about.</p>\n<p>I’m open to sorting by ID once we have all the data back if you’d find it useful, I don’t think it would help programmatic usage much but does make the data nicer to look at.</p>","arenanet":true},{"pubDate":"2014-09-14T19:43:13.000Z","guid":"http://forum-en.guildwars2.com/forum/community/api/Order-of-ids-returned-v2-commerce-listings/4412200","author":"smiley.1438","body":"\n<p>So why exactly should we go the extra mile in about every language? And where is the advantage to have the ID as actual value in an unordered array over having it as identifier of an associative array?</p>\n<blockquote><div class=\"citey\"><cite title=\"Posted on September 14 2014 05:11PM\"><a href=\"/forum/community/api/Order-of-ids-returned-v2-commerce-listings/4411804\">smiley.1438:</a></cite></div><div class=\"quotey\"><p>The API should not complicate stuff but be as convenient as possible. I highly doubt that not being able to directly access the results is convenient at all.</p></div></blockquote>","arenanet":false},{"pubDate":"2014-09-14T19:18:26.000Z","guid":"http://forum-en.guildwars2.com/forum/community/api/Order-of-ids-returned-v2-commerce-listings/4412137","author":"darthmaim.6017","body":"\n<p>Its the same for all other languages, even if those don’t have such a nice helper function built in, you can always write it yourself. Since querying the API will almost always be slower than what you are doing with the data once you got it, your code doesn’t even need to be super fast.</p>","arenanet":false},{"pubDate":"2014-09-14T19:08:30.000Z","guid":"http://forum-en.guildwars2.com/forum/community/api/Order-of-ids-returned-v2-commerce-listings/4412118","author":"smiley.1438","body":"\n<p>(we’re not only speaking about php which has some neat functions to sort this out, my example was just in php because lazy)</p>\n<p>(also: (PHP 5 &gt;= 5.5.0), so array_column() may not be available to everyone)</p>","arenanet":false},{"pubDate":"2014-09-14T18:57:16.000Z","guid":"http://forum-en.guildwars2.com/forum/community/api/Order-of-ids-returned-v2-commerce-listings/4412087","author":"darthmaim.6017","body":"\n<p>Well, its just one line more to do it with the current api if you need to that:</p>\n<pre><code>$requestedIDs = [ 123, 456, 789 ];\n$result = getItemsFromApi( $requestedIDs ); // builds the url, requests it and decodes the json\n$result = array_column( $result, null, 'item_id' ); // this is new\n\nforeach( $requestedIDs as $id ){\n    $item = $result[ $id ];\n    // do stuff\n    print_r($item);\n}</code></pre>","arenanet":false},{"pubDate":"2014-09-14T18:06:20.000Z","guid":"http://forum-en.guildwars2.com/forum/community/api/Order-of-ids-returned-v2-commerce-listings/4411955","author":"smiley.1438","body":"\n<p>You got me wrong here. A little example to clarify:</p>\n<pre><code>$requested_items = [123, 456, 789];\n\n$url = '.../v2/endpoint?'.http_build_query(['ids' =&gt; implode(',', $requested_items)]);\n\n// -&gt; request to $url, returns $result_items after json_decode()\n\nforeach($requested_items as $id){\n\t// do stuff\n\tprint_r($result_items[$id]);\n}</code></pre>\n<p>This way it wouldn’t even matter when you requested the same id a couple times and got just one result for it (iirc someone complained about that the other day… (…))</p>","arenanet":false},{"pubDate":"2014-09-14T17:53:45.000Z","guid":"http://forum-en.guildwars2.com/forum/community/api/Order-of-ids-returned-v2-commerce-listings/4411921","author":"darthmaim.6017","body":"\n<p>Well, it doesn’t matter if you loop over your id’s or the result, both is O(n) and should take exactly the same time. You can build your dictionary there to later access specific items of the result with a complexity of O(1). If you don’t want to access all items you request, you shouldn’t request them in the first place.</p>","arenanet":false},{"pubDate":"2014-09-14T17:11:11.000Z","guid":"http://forum-en.guildwars2.com/forum/community/api/Order-of-ids-returned-v2-commerce-listings/4411804","author":"smiley.1438","body":"\n<p>Thats what i currently do. However, having an associative array (“dictionary” as you call it…<img src=\"/include/images/smilies/colondee.png\">) in first place would save looping over it twice. In fact, you wouldn’t even need to loop over the results at all, but over your list of requested IDs and just assign the result values.</p>\n<p>The API should not complicate stuff but be as convenient as possible. I highly doubt that not being able to directly access the results is convenient at all.</p>","arenanet":false},{"pubDate":"2014-09-14T17:07:22.000Z","guid":"http://forum-en.guildwars2.com/forum/community/api/Order-of-ids-returned-v2-commerce-listings/4411793","author":"darthmaim.6017","body":"\n<p>Well, in most cases you are looping at least once over all items returned and you can build your dictionary there, so it in the end, it doesn’t even matter.</p>","arenanet":false},{"pubDate":"2014-09-14T16:16:57.000Z","guid":"http://forum-en.guildwars2.com/forum/community/api/Order-of-ids-returned-v2-commerce-listings/4411629","author":"smiley.1438","body":"\n<p>Thats the reason why i’d prefer the results indexed by their id instead of having the id as actual value.</p>\n<pre><code>{\n  \"item_id\": {\n    \"key1\": \"value1\"\n    ...\n  },\n  ...\n}</code></pre>\n<p>Would actually save a lot hassle since you could directly access the objects and the order wouldn’t matter at all. (I’ve suggested that more than once…). Also, the identifier is passed as key to functions like JQuerys $.each() or prototype’s Enumerable.each() or could be as well used in foreach() loops in several C-like languages, so i wonder why this suboptimal response format was chosen.</p>","arenanet":false},{"pubDate":"2014-09-14T16:08:22.000Z","guid":"http://forum-en.guildwars2.com/forum/community/api/Order-of-ids-returned-v2-commerce-listings/4411610","author":"Alcarin.9024","body":"\n<p>I made a test to try to guess what is the order and why ( <a href=\"http://jsfiddle.net/Alcarin/gy13r52t/2/\">http://jsfiddle.net/Alcarin/gy13r52t/2/</a> ).<br>\nResults are that if you request 60 times 36088,46047,46054,45881,46045 you get:<br>\n30% of the times 36088,45881,46045,46047,46054<br>\n10% of the times 36088,45881,46047,46045,46054<br>\n10% of the times 36088,46054,45881,46045,46047<br>\n10% of the times 36088,45881,46045,46054,46047<br>\n40% of the times are splitted in other 14 different orders</p>\n<p>So my guess here is that each request is split in different workers, each worker search for a single item, and the response is built when all workers have found their items. Backend database order should be ascended by item_id, so most of the times workers complete their job following that order, but if some workers is little busy, there may be a very little delay that cause the order to no longer be ascended by item_id.</p>\n<p>So, don’t trust at all the response order. Reorder the response as suggested by smiley, or perform a search inside the response to get items in your desired order.</p>","arenanet":false},{"pubDate":"2014-09-14T07:08:54.000Z","guid":"http://forum-en.guildwars2.com/forum/community/api/Order-of-ids-returned-v2-commerce-listings/4410457","author":"StevenL.3761","body":"\n<p>My best guess is that listings are (lazily) loaded in parallel, so the order would be undefined. For practical purposes, that means that the list goes from listings with few offers to listings with lots of offers.</p>\n<p>No idea if that’s how it really works.</p>","arenanet":false},{"pubDate":"2014-09-13T07:09:41.000Z","guid":"http://forum-en.guildwars2.com/forum/community/api/Order-of-ids-returned-v2-commerce-listings/4406697","author":"Leighwyn McClendon.9346","body":"\n<blockquote><div class=\"citey\"><cite title=\"Posted on September 13 2014 05:36AM\"><a href=\"/forum/community/api/Order-of-ids-returned-v2-commerce-listings/4406440\">smiley.1438:</a></cite></div><div class=\"quotey\"><p>/dontcare?</p>\n<p><strong>hint</strong> <a href=\"http://phpjs.org/functions/array_multisort/\">http://phpjs.org/functions/array_multisort/</a> <strong>hint</strong></p></div></blockquote>\n<p>I am struggling to take the high road with that reply, but here goes.  The behavior was strange enough to make me curious.  I thought that this was a good place to ask whether someone knew what might be going on behind the scenes to cause it.</p>\n<p>Yes, there are ways to work around the seemingly random order that the API delivers the output in, ways that are obvious enough to not need hints.  What wasn’t obvious is why the API might output in that order at all.</p>","arenanet":false},{"pubDate":"2014-09-13T05:36:08.000Z","guid":"http://forum-en.guildwars2.com/forum/community/api/Order-of-ids-returned-v2-commerce-listings/4406440","author":"smiley.1438","body":"\n<p>/dontcare?</p>\n<p>*hint* <a href=\"http://phpjs.org/functions/array_multisort/\">http://phpjs.org/functions/array_multisort/</a> *hint*</p>","arenanet":false},{"pubDate":"2014-09-13T04:48:19.000Z","guid":"http://forum-en.guildwars2.com/forum/community/api/Order-of-ids-returned-v2-commerce-listings/4406353","author":"Leighwyn McClendon.9346","body":"\n<p>If anyone knows how the commerce API orders the data it returns, could they share?</p>\n<p>Example, <a href=\"https://api.guildwars2.com/v2/commerce/listings?ids=36088,46047,46054,45881,46045\">test link</a></p>\n<p>I gave it five id’s not in numerical order.  Specifically, they were ordered “1, 4, 5, 2, 3”</p>\n<p>When I inspect the JSON returned, it gives me the values in “1, 2, 4, 5, 3” order.  Still not sorted by ID, not in the order I gave them, and I can’t really find anything else that it might’ve sorted it by to achieve the order it gave them back in.</p>\n<p>Ideas?</p>","arenanet":false}]}