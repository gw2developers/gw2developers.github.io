<!DOCTYPE html>
<html lang="en">

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Order of ids returned, v2/commerce/listings</title>
  <meta name="description" content="Learn how to use the GW2 API.">

  <link rel="stylesheet" href="/assets/main.css">
  <link rel="canonical" href="/forum-backup/Order-of-ids-returned-v2-commerce-listings/">
  <link rel="alternate" type="application/rss+xml" title="GW2 Developers" href="/feed.xml">
  
  
  <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-106748097-1', 'auto');
  ga('send', 'pageview');

</script>
  

  
</head>


  <body>

    <header class="site-header" role="banner">

  <div class="wrapper">
    
    
    <a class="site-title" href="/"><img src="/assets/images/logo.svg"></a>
  
    
      <nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
              <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
              <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger">
          
            
            
          
            
            
            <a class="page-link" href="/forum-backup/">Forum Backup</a>
            
          
            
            
            <a class="page-link" href="/guides/">Guides</a>
            
          
            
            
          
            
            
          
            
            
          
        </div>
      </nav>
    
  </div>
</header>

    <main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post">

  <header class="post-header">
    <h1 class="post-title">Order of ids returned, v2/commerce/listings</h1>
  </header>

  <div class="post-content">
    


<p class="post-meta">
    Original Url: http://forum-en.guildwars2.com/forum/community/api/Order-of-ids-returned-v2-commerce-listings
</p>



<h2 id="">Leighwyn McClendon.9346:</h2>
<p class="post-meta">
    <time datetime="2014-09-13T04:48:19+00:00">
        13 Sep 2014
    </time>
</p>
<p>
<p>If anyone knows how the commerce API orders the data it returns, could they share?</p>
<p>Example, <a href="https://api.guildwars2.com/v2/commerce/listings?ids=36088,46047,46054,45881,46045">test link</a></p>
<p>I gave it five id’s not in numerical order.  Specifically, they were ordered “1, 4, 5, 2, 3”</p>
<p>When I inspect the JSON returned, it gives me the values in “1, 2, 4, 5, 3” order.  Still not sorted by ID, not in the order I gave them, and I can’t really find anything else that it might’ve sorted it by to achieve the order it gave them back in.</p>
<p>Ideas?</p></p>

<h2 id="">smiley.1438:</h2>
<p class="post-meta">
    <time datetime="2014-09-13T05:36:08+00:00">
        13 Sep 2014
    </time>
</p>
<p>
<p>/dontcare?</p>
<p>*hint* <a href="http://phpjs.org/functions/array_multisort/">http://phpjs.org/functions/array_multisort/</a> *hint*</p></p>

<h2 id="">Leighwyn McClendon.9346:</h2>
<p class="post-meta">
    <time datetime="2014-09-13T07:09:41+00:00">
        13 Sep 2014
    </time>
</p>
<p>
<blockquote><div class="citey"><cite title="Posted on September 13 2014 05:36AM"><a href="/forum/community/api/Order-of-ids-returned-v2-commerce-listings/4406440">smiley.1438:</a></cite></div><div class="quotey"><p>/dontcare?</p>
<p><strong>hint</strong> <a href="http://phpjs.org/functions/array_multisort/">http://phpjs.org/functions/array_multisort/</a> <strong>hint</strong></p></div></blockquote>
<p>I am struggling to take the high road with that reply, but here goes.  The behavior was strange enough to make me curious.  I thought that this was a good place to ask whether someone knew what might be going on behind the scenes to cause it.</p>
<p>Yes, there are ways to work around the seemingly random order that the API delivers the output in, ways that are obvious enough to not need hints.  What wasn’t obvious is why the API might output in that order at all.</p></p>

<h2 id="">StevenL.3761:</h2>
<p class="post-meta">
    <time datetime="2014-09-14T07:08:54+00:00">
        14 Sep 2014
    </time>
</p>
<p>
<p>My best guess is that listings are (lazily) loaded in parallel, so the order would be undefined. For practical purposes, that means that the list goes from listings with few offers to listings with lots of offers.</p>
<p>No idea if that’s how it really works.</p></p>

<h2 id="">Alcarin.9024:</h2>
<p class="post-meta">
    <time datetime="2014-09-14T16:08:22+00:00">
        14 Sep 2014
    </time>
</p>
<p>
<p>I made a test to try to guess what is the order and why ( <a href="http://jsfiddle.net/Alcarin/gy13r52t/2/">http://jsfiddle.net/Alcarin/gy13r52t/2/</a> ).<br>
Results are that if you request 60 times 36088,46047,46054,45881,46045 you get:<br>
30% of the times 36088,45881,46045,46047,46054<br>
10% of the times 36088,45881,46047,46045,46054<br>
10% of the times 36088,46054,45881,46045,46047<br>
10% of the times 36088,45881,46045,46054,46047<br>
40% of the times are splitted in other 14 different orders</p>
<p>So my guess here is that each request is split in different workers, each worker search for a single item, and the response is built when all workers have found their items. Backend database order should be ascended by item_id, so most of the times workers complete their job following that order, but if some workers is little busy, there may be a very little delay that cause the order to no longer be ascended by item_id.</p>
<p>So, don’t trust at all the response order. Reorder the response as suggested by smiley, or perform a search inside the response to get items in your desired order.</p></p>

<h2 id="">smiley.1438:</h2>
<p class="post-meta">
    <time datetime="2014-09-14T16:16:57+00:00">
        14 Sep 2014
    </time>
</p>
<p>
<p>Thats the reason why i’d prefer the results indexed by their id instead of having the id as actual value.</p>
<pre><code>{
  "item_id": {
    "key1": "value1"
    ...
  },
  ...
}</code></pre>
<p>Would actually save a lot hassle since you could directly access the objects and the order wouldn’t matter at all. (I’ve suggested that more than once…). Also, the identifier is passed as key to functions like JQuerys $.each() or prototype’s Enumerable.each() or could be as well used in foreach() loops in several C-like languages, so i wonder why this suboptimal response format was chosen.</p></p>

<h2 id="">darthmaim.6017:</h2>
<p class="post-meta">
    <time datetime="2014-09-14T17:07:22+00:00">
        14 Sep 2014
    </time>
</p>
<p>
<p>Well, in most cases you are looping at least once over all items returned and you can build your dictionary there, so it in the end, it doesn’t even matter.</p></p>

<h2 id="">smiley.1438:</h2>
<p class="post-meta">
    <time datetime="2014-09-14T17:11:11+00:00">
        14 Sep 2014
    </time>
</p>
<p>
<p>Thats what i currently do. However, having an associative array (“dictionary” as you call it…<img src="/include/images/smilies/colondee.png">) in first place would save looping over it twice. In fact, you wouldn’t even need to loop over the results at all, but over your list of requested IDs and just assign the result values.</p>
<p>The API should not complicate stuff but be as convenient as possible. I highly doubt that not being able to directly access the results is convenient at all.</p></p>

<h2 id="">darthmaim.6017:</h2>
<p class="post-meta">
    <time datetime="2014-09-14T17:53:45+00:00">
        14 Sep 2014
    </time>
</p>
<p>
<p>Well, it doesn’t matter if you loop over your id’s or the result, both is O(n) and should take exactly the same time. You can build your dictionary there to later access specific items of the result with a complexity of O(1). If you don’t want to access all items you request, you shouldn’t request them in the first place.</p></p>

<h2 id="">smiley.1438:</h2>
<p class="post-meta">
    <time datetime="2014-09-14T18:06:20+00:00">
        14 Sep 2014
    </time>
</p>
<p>
<p>You got me wrong here. A little example to clarify:</p>
<pre><code>$requested_items = [123, 456, 789];

$url = '.../v2/endpoint?'.http_build_query(['ids' =&gt; implode(',', $requested_items)]);

// -&gt; request to $url, returns $result_items after json_decode()

foreach($requested_items as $id){
	// do stuff
	print_r($result_items[$id]);
}</code></pre>
<p>This way it wouldn’t even matter when you requested the same id a couple times and got just one result for it (iirc someone complained about that the other day… (…))</p></p>

<h2 id="">darthmaim.6017:</h2>
<p class="post-meta">
    <time datetime="2014-09-14T18:57:16+00:00">
        14 Sep 2014
    </time>
</p>
<p>
<p>Well, its just one line more to do it with the current api if you need to that:</p>
<pre><code>$requestedIDs = [ 123, 456, 789 ];
$result = getItemsFromApi( $requestedIDs ); // builds the url, requests it and decodes the json
$result = array_column( $result, null, 'item_id' ); // this is new

foreach( $requestedIDs as $id ){
    $item = $result[ $id ];
    // do stuff
    print_r($item);
}</code></pre></p>

<h2 id="">smiley.1438:</h2>
<p class="post-meta">
    <time datetime="2014-09-14T19:08:30+00:00">
        14 Sep 2014
    </time>
</p>
<p>
<p>(we’re not only speaking about php which has some neat functions to sort this out, my example was just in php because lazy)</p>
<p>(also: (PHP 5 &gt;= 5.5.0), so array_column() may not be available to everyone)</p></p>

<h2 id="">darthmaim.6017:</h2>
<p class="post-meta">
    <time datetime="2014-09-14T19:18:26+00:00">
        14 Sep 2014
    </time>
</p>
<p>
<p>Its the same for all other languages, even if those don’t have such a nice helper function built in, you can always write it yourself. Since querying the API will almost always be slower than what you are doing with the data once you got it, your code doesn’t even need to be super fast.</p></p>

<h2 id="">smiley.1438:</h2>
<p class="post-meta">
    <time datetime="2014-09-14T19:43:13+00:00">
        14 Sep 2014
    </time>
</p>
<p>
<p>So why exactly should we go the extra mile in about every language? And where is the advantage to have the ID as actual value in an unordered array over having it as identifier of an associative array?</p>
<blockquote><div class="citey"><cite title="Posted on September 14 2014 05:11PM"><a href="/forum/community/api/Order-of-ids-returned-v2-commerce-listings/4411804">smiley.1438:</a></cite></div><div class="quotey"><p>The API should not complicate stuff but be as convenient as possible. I highly doubt that not being able to directly access the results is convenient at all.</p></div></blockquote></p>

<h2 id="">Pat Cavit.9234:</h2>
<p class="post-meta">
    <time datetime="2014-09-15T18:39:55+00:00">
        15 Sep 2014
    </time>
</p>
<p>
<blockquote><div class="citey"><cite title="Posted on September 14 2014 07:08AM"><a href="/forum/community/api/Order-of-ids-returned-v2-commerce-listings/4410457">StevenL.3761:</a></cite></div><div class="quotey"><p>My best guess is that listings are (lazily) loaded in parallel, so the order would be undefined. For practical purposes, that means that the list goes from listings with few offers to listings with lots of offers.</p>
<p>No idea if that’s how it really works.</p></div></blockquote>
<p>Yup, we make a bunch of async requests for the data and simply assemble it in the order it returns.</p>
<p>Now, as for object-vs-array:</p>
<p>Shoving results onto the end of an array as we get them back is easy and lets you do nice things like check the length of the array to see how many items you got back. It also means you can use useful array functionality like (JS examples) .some(), .every(), .reduce(), etc w/o first having to jump through a bunch of hoops.</p>
<p>Constant-time lookups of a specific data ID doesn’t feel like a worthwhile trade-off for an API that is generally intended to provide bulk data, and if you did want that you could ask the API for data for the specific ID you cared about.</p>
<p>I’m open to sorting by ID once we have all the data back if you’d find it useful, I don’t think it would help programmatic usage much but does make the data nicer to look at.</p></p>

<h2 id="">StevenL.3761:</h2>
<p class="post-meta">
    <time datetime="2014-09-18T09:08:50+00:00">
        18 Sep 2014
    </time>
</p>
<p>
<p>Is the public API written in .NET? You might be able to get better performance if you use <a href="http://msdn.microsoft.com/en-us/library/system.threading.tasks.task.whenany(v=vs.110).aspx">Task.WhenAny()</a> to process requests as soon as they complete. Waiting for all requests to complete before handling their response means wasted CPU time. Client applications will benefit as well if they support streaming JSON while it is still being created.</p></p>

<h2 id="">Pat Cavit.9234:</h2>
<p class="post-meta">
    <time datetime="2014-09-18T21:25:54+00:00">
        18 Sep 2014
    </time>
</p>
<p>
<blockquote><div class="citey"><cite title="Posted on September 18 2014 09:08AM"><a href="/forum/community/api/Order-of-ids-returned-v2-commerce-listings/4424728">StevenL.3761:</a></cite></div><div class="quotey"><p>Is the public API written in .NET? You might be able to get better performance if you use <a href="http://msdn.microsoft.com/en-us/library/system.threading.tasks.task.whenany(v=vs.110).aspx">Task.WhenAny()</a> to process requests as soon as they complete. Waiting for all requests to complete before handling their response means wasted CPU time. Client applications will benefit as well if they support streaming JSON while it is still being created.</p></div></blockquote>
<p>We don’t use .NET &amp; for simplicity’s sake we don’t stream responses right now. We’re processing each individual request as soon as it completes but we’re not blocking on the responses or anything. It works like nodejs, conceptually.</p></p>

<h2 id="">StevenL.3761:</h2>
<p class="post-meta">
    <time datetime="2014-09-18T22:09:09+00:00">
        18 Sep 2014
    </time>
</p>
<p>
<p>Oooh<img src="/include/images/smilies/colondee.png"> I had no idea that nodejs works with IIS.</p></p>

<h2 id="">Pat Cavit.9234:</h2>
<p class="post-meta">
    <time datetime="2014-09-18T22:22:20+00:00">
        18 Sep 2014
    </time>
</p>
<p>
<blockquote><div class="citey"><cite title="Posted on September 18 2014 10:09PM"><a href="/forum/community/api/Order-of-ids-returned-v2-commerce-listings/4426843">StevenL.3761:</a></cite></div><div class="quotey"><p>Oooh<img src="/include/images/smilies/colondee.png"> I had no idea that nodejs works with IIS.</p></div></blockquote>
<p>It’s not nodejs, it just works like it. We use <a href="https://en.wikipedia.org/wiki/Application_Request_Routing">ARR</a> as a load-balancer and HTTPS endpoint which is why you’re thinking we use IIS.</p></p>

<h2 id="">poke.3712:</h2>
<p class="post-meta">
    <time datetime="2014-09-25T20:45:28+00:00">
        25 Sep 2014
    </time>
</p>
<p>
<blockquote><div class="citey"><cite title="Posted on September 15 2014 06:39PM"><a href="/forum/community/api/Order-of-ids-returned-v2-commerce-listings/4415361">Pat Cavit.9234:</a></cite></div><div class="quotey"><p>Yup, we make a bunch of async requests for the data and simply assemble it in the order it returns.</p></div></blockquote>
<p>Is that order consistent enough for paging though? I.e. when using the paging mechanism, can I be sure that I get <strong>every</strong> object at some point, or is it possible that some will be missed because the order for one page ended up being different than the other?</p></p>

<h2 id="">Pat Cavit.9234:</h2>
<p class="post-meta">
    <time datetime="2014-09-25T20:48:04+00:00">
        25 Sep 2014
    </time>
</p>
<p>
<blockquote><div class="citey"><cite title="Posted on September 25 2014 08:45PM"><a href="/forum/community/api/Order-of-ids-returned-v2-commerce-listings/4445374">poke.3712:</a></cite></div><div class="quotey"><blockquote><div class="citey"><cite title="Posted on September 15 2014 06:39PM"><a href="/forum/community/api/Order-of-ids-returned-v2-commerce-listings/4415361">Pat Cavit.9234:</a></cite></div><div class="quotey"><p>Yup, we make a bunch of async requests for the data and simply assemble it in the order it returns.</p></div></blockquote>
<p>Is that order consistent enough for paging though? I.e. when using the paging mechanism, can I be sure that I get <strong>every</strong> object at some point, or is it possible that some will be missed because the order for one page ended up being different than the other?</p></div></blockquote>
<p>We start w/ the complete list of IDs for paging, so yes. Each individual page may not have a guaranteed order, but it does have a guaranteed set of IDs that will be returned.</p></p>


  </div>

</article>

      </div>
    </main>

    <footer class="site-footer">

  <div class="wrapper">

    <h2 class="footer-heading">GW2 Developers</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li>
            
              GW2 Developers
            
            </li>
            
            <li><a href="mailto:gw2developers@darthmaim.de">gw2developers@darthmaim.de</a></li>
            
        </ul>
      </div>

      <div class="footer-col footer-col-2">
        <ul class="social-media-list">
          
          <li>
            <a href="https://github.com/gw2developers"><span class="icon icon--github"><svg viewBox="0 0 16 16" width="16px" height="16px"><path fill="#828282" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761 c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32 c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472 c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037 C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65 c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261 c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082 c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129 c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"/></svg>
</span><span class="username">gw2developers</span></a>

          </li>
          

          
          <li>
            <a href="https://twitter.com/gw2api"><span class="icon icon--twitter"><svg viewBox="0 0 16 16" width="16px" height="16px"><path fill="#828282" d="M15.969,3.058c-0.586,0.26-1.217,0.436-1.878,0.515c0.675-0.405,1.194-1.045,1.438-1.809c-0.632,0.375-1.332,0.647-2.076,0.793c-0.596-0.636-1.446-1.033-2.387-1.033c-1.806,0-3.27,1.464-3.27,3.27 c0,0.256,0.029,0.506,0.085,0.745C5.163,5.404,2.753,4.102,1.14,2.124C0.859,2.607,0.698,3.168,0.698,3.767 c0,1.134,0.577,2.135,1.455,2.722C1.616,6.472,1.112,6.325,0.671,6.08c0,0.014,0,0.027,0,0.041c0,1.584,1.127,2.906,2.623,3.206 C3.02,9.402,2.731,9.442,2.433,9.442c-0.211,0-0.416-0.021-0.615-0.059c0.416,1.299,1.624,2.245,3.055,2.271 c-1.119,0.877-2.529,1.4-4.061,1.4c-0.264,0-0.524-0.015-0.78-0.046c1.447,0.928,3.166,1.469,5.013,1.469 c6.015,0,9.304-4.983,9.304-9.304c0-0.142-0.003-0.283-0.009-0.423C14.976,4.29,15.531,3.714,15.969,3.058z"/></svg>
</span><span class="username">gw2api</span></a>

          </li>
          
        </ul>
      </div>

      <div class="footer-col footer-col-3">
        <p>Learn how to use the GW2 API.
</p>
      </div>
    </div>

  </div>

</footer>


  </body>

</html>
